<!DOCTYPE html>

<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Crypto Daytrader Signal Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&family=Rajdhani:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #040810;
    --surface: #080f1e;
    --surface2: #0d1a2e;
    --accent: #00d4ff;
    --red: #ff3a3a;
    --green: #00ff88;
    --yellow: #ffd700;
    --orange: #ff8c00;
    --text: #c8deff;
    --text-dim: #4a6080;
    --border: #0d2a45;
    --glow: 0 0 20px rgba(0,212,255,0.3);
    --glow-green: 0 0 20px rgba(0,255,136,0.4);
    --glow-red: 0 0 20px rgba(255,58,58,0.4);
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Rajdhani', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }
  body::before {
    content:'';
    position:fixed; inset:0;
    background-image:
      linear-gradient(rgba(0,212,255,0.03) 1px,transparent 1px),
      linear-gradient(90deg,rgba(0,212,255,0.03) 1px,transparent 1px);
    background-size:50px 50px;
    animation:gridMove 20s linear infinite;
    pointer-events:none; z-index:0;
  }
  @keyframes gridMove { 0%{transform:translateY(0)} 100%{transform:translateY(50px)} }
  body::after {
    content:''; position:fixed; inset:0;
    background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,0.05) 2px,rgba(0,0,0,0.05) 4px);
    pointer-events:none; z-index:0;
  }
  .container { max-width:1400px; margin:0 auto; padding:20px; position:relative; z-index:1; }

/* HEADER */
header {
display:flex; justify-content:space-between; align-items:center;
padding:24px 0 20px; border-bottom:1px solid var(â€“border);
margin-bottom:0; animation:fadeDown 0.6s ease both;
}
.logo { display:flex; align-items:center; gap:16px; }
.logo-icon {
width:48px; height:48px;
background:linear-gradient(135deg,#00d4ff,#0050aa);
border-radius:12px; display:flex; align-items:center; justify-content:center;
font-family:â€˜Orbitronâ€™,monospace; font-weight:900; font-size:14px; color:#fff;
box-shadow:var(â€“glow); position:relative; overflow:hidden;
transition: all 0.4s ease;
}
.logo-icon::after {
content:â€™â€™; position:absolute; top:-50%; left:-50%; width:200%; height:200%;
background:linear-gradient(transparent,rgba(255,255,255,0.1),transparent);
animation:shine 3s infinite;
}
@keyframes shine { 0%{transform:rotate(0deg)} 100%{transform:rotate(360deg)} }
.logo h1 { font-family:â€˜Orbitronâ€™,monospace; font-size:22px; font-weight:900; color:#fff; letter-spacing:3px; }
.logo p { font-family:â€˜Share Tech Monoâ€™,monospace; font-size:11px; color:var(â€“accent); letter-spacing:2px; }
.header-right { display:flex; align-items:center; gap:20px; }
.live-badge {
display:inline-flex; align-items:center; gap:8px;
background:rgba(0,255,136,0.1); border:1px solid var(â€“green);
border-radius:20px; padding:6px 14px;
font-family:â€˜Share Tech Monoâ€™,monospace; font-size:12px; color:var(â€“green); letter-spacing:1px;
}
.live-dot { width:8px; height:8px; border-radius:50%; background:var(â€“green); animation:pulse 1.5s ease-in-out infinite; }
@keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:0.4;transform:scale(0.8)} }
.timestamp { font-family:â€˜Share Tech Monoâ€™,monospace; font-size:11px; color:var(â€“text-dim); }

/* COIN SELECTOR BAR */
.selector-bar {
background: var(â€“surface);
border-bottom: 1px solid var(â€“border);
padding: 16px 20px;
display: flex;
align-items: center;
gap: 16px;
flex-wrap: wrap;
position: sticky;
top: 0;
z-index: 100;
backdrop-filter: blur(10px);
}
.selector-label {
font-family:â€˜Share Tech Monoâ€™,monospace;
font-size:11px; color:var(â€“text-dim); letter-spacing:2px;
white-space: nowrap;
}
.coin-select-wrap {
position: relative;
flex-shrink: 0;
}
.coin-select {
appearance: none;
background: rgba(0,212,255,0.07);
border: 1px solid var(â€“accent);
border-radius: 10px;
color: #fff;
font-family:â€˜Orbitronâ€™,monospace;
font-size: 14px;
font-weight: 700;
padding: 10px 44px 10px 16px;
cursor: pointer;
outline: none;
letter-spacing: 1px;
min-width: 200px;
box-shadow: var(â€“glow);
transition: all 0.3s;
}
.coin-select:hover, .coin-select:focus {
background: rgba(0,212,255,0.15);
box-shadow: 0 0 30px rgba(0,212,255,0.4);
}
.coin-select option {
background: #0a1525;
color: #fff;
font-family: â€˜Share Tech Monoâ€™, monospace;
font-size: 13px;
}
.select-arrow {
position:absolute; right:14px; top:50%; transform:translateY(-50%);
color:var(â€“accent); pointer-events:none; font-size:12px;
}
.analyze-btn {
background: linear-gradient(135deg, #00d4ff, #0055cc);
border: none; border-radius: 10px;
color: #fff; font-family:â€˜Orbitronâ€™,monospace;
font-size: 12px; font-weight: 700;
padding: 11px 24px; cursor: pointer;
letter-spacing: 2px;
box-shadow: var(â€“glow);
transition: all 0.3s;
white-space: nowrap;
}
.analyze-btn:hover { transform:translateY(-2px); box-shadow:0 0 40px rgba(0,212,255,0.5); }
.analyze-btn:disabled { opacity:0.5; cursor:not-allowed; transform:none; }

/* QUICK COIN CHIPS */
.coin-chips {
display: flex; gap: 8px; flex-wrap: wrap;
}
.chip {
background: rgba(255,255,255,0.05);
border: 1px solid var(â€“border);
border-radius: 20px;
padding: 5px 12px;
font-family:â€˜Share Tech Monoâ€™,monospace;
font-size: 11px; color: var(â€“text-dim);
cursor: pointer;
transition: all 0.2s;
letter-spacing: 1px;
}
.chip:hover, .chip.active {
background: rgba(0,212,255,0.1);
border-color: var(â€“accent);
color: var(â€“accent);
}

/* TICKER */
.ticker-wrap {
background:var(â€“surface); border-bottom:1px solid var(â€“border);
padding:8px 0; overflow:hidden; position:relative;
}
.ticker-content {
display:flex; gap:60px; animation:ticker 30s linear infinite; white-space:nowrap;
}
@keyframes ticker { 0%{transform:translateX(0)} 100%{transform:translateX(-50%)} }
.ticker-item { display:inline-flex; align-items:center; gap:10px; font-family:â€˜Share Tech Monoâ€™,monospace; font-size:12px; color:var(â€“text-dim); }
.ticker-item .tk-sym { color:var(â€“accent); font-weight:700; }
.ticker-item .tk-up { color:var(â€“green); }
.ticker-item .tk-down { color:var(â€“red); }

/* LOADING */
.loading-overlay {
display: none;
position: fixed; inset: 0;
background: rgba(4,8,16,0.85);
z-index: 200;
align-items: center; justify-content: center;
flex-direction: column; gap: 20px;
backdrop-filter: blur(4px);
}
.loading-overlay.active { display: flex; }
.loading-spinner {
width: 60px; height: 60px;
border: 3px solid rgba(0,212,255,0.2);
border-top-color: var(â€“accent);
border-radius: 50%;
animation: spin 0.8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }
.loading-text {
font-family:â€˜Orbitronâ€™,monospace; font-size:14px;
color:var(â€“accent); letter-spacing:3px;
animation: flicker 1.5s ease-in-out infinite;
}
.loading-sub { font-family:â€˜Share Tech Monoâ€™,monospace; font-size:11px; color:var(â€“text-dim); letter-spacing:1px; }
@keyframes flicker { 0%,100%{opacity:1} 50%{opacity:0.5} }

/* PRICE HERO */
.price-hero {
background:linear-gradient(135deg,var(â€“surface) 0%,#0a1525 100%);
border:1px solid var(â€“border); border-radius:16px;
padding:32px; margin-bottom:24px;
display:grid; grid-template-columns:1fr 1fr 1fr; gap:24px; align-items:center;
position:relative; overflow:hidden;
animation:fadeUp 0.5s ease both;
}
.price-hero-bg {
position:absolute; right:-20px; top:50%; transform:translateY(-50%);
font-family:â€˜Orbitronâ€™,monospace; font-size:160px; font-weight:900;
color:rgba(0,212,255,0.04); pointer-events:none; letter-spacing:-5px;
transition: all 0.5s ease;
}
.current-price { text-align:center; }
.price-label { font-family:â€˜Share Tech Monoâ€™,monospace; font-size:11px; color:var(â€“text-dim); letter-spacing:3px; margin-bottom:8px; }
.price-value { font-family:â€˜Orbitronâ€™,monospace; font-size:48px; font-weight:900; color:#fff; letter-spacing:-1px; line-height:1; text-shadow:0 0 30px rgba(0,212,255,0.5); }
.price-change { font-family:â€˜Orbitronâ€™,monospace; font-size:18px; font-weight:700; margin-top:8px; }
.price-change.up { color:var(â€“green); }
.price-change.down { color:var(â€“red); }
.stats-grid { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
.stat-box { background:rgba(0,212,255,0.05); border:1px solid rgba(0,212,255,0.15); border-radius:10px; padding:12px 16px; }
.stat-label { font-family:â€˜Share Tech Monoâ€™,monospace; font-size:10px; color:var(â€“text-dim); letter-spacing:1px; margin-bottom:4px; }
.stat-val { font-family:â€˜Orbitronâ€™,monospace; font-size:14px; font-weight:700; color:var(â€“accent); }

/* SIGNAL */
.signal-box { border-radius:16px; padding:28px; text-align:center; position:relative; overflow:hidden; border:2px solid; transition:all 0.5s; }
.signal-box.neutral { background:linear-gradient(135deg,rgba(255,215,0,0.08),rgba(255,140,0,0.05)); border-color:var(â€“yellow); box-shadow:0 0 40px rgba(255,215,0,0.15); }
.signal-box.buy { background:linear-gradient(135deg,rgba(0,255,136,0.1),rgba(0,180,90,0.05)); border-color:var(â€“green); box-shadow:var(â€“glow-green); }
.signal-box.sell { background:linear-gradient(135deg,rgba(255,58,58,0.1),rgba(180,0,0,0.05)); border-color:var(â€“red); box-shadow:var(â€“glow-red); }
.signal-label { font-family:â€˜Share Tech Monoâ€™,monospace; font-size:11px; color:var(â€“text-dim); letter-spacing:3px; margin-bottom:12px; }
.signal-value { font-family:â€˜Orbitronâ€™,monospace; font-size:32px; font-weight:900; letter-spacing:3px; margin-bottom:10px; }
.neutral .signal-value { color:var(â€“yellow); text-shadow:0 0 20px rgba(255,215,0,0.5); }
.buy .signal-value { color:var(â€“green); text-shadow:0 0 20px rgba(0,255,136,0.5); }
.sell .signal-value { color:var(â€“red); text-shadow:0 0 20px rgba(255,58,58,0.5); }
.signal-sub { font-size:13px; color:var(â€“text); font-weight:600; letter-spacing:1px; }
.signal-confidence { margin-top:14px; font-family:â€˜Share Tech Monoâ€™,monospace; font-size:12px; }
.neutral .signal-confidence { color:var(â€“yellow); }
.buy .signal-confidence { color:var(â€“green); }
.sell .signal-confidence { color:var(â€“red); }

/* GRIDS */
.main-grid { display:grid; grid-template-columns:2fr 1fr; gap:20px; margin-bottom:20px; }
.bottom-grid { display:grid; grid-template-columns:1fr 1fr 1fr; gap:20px; margin-bottom:20px; }

/* CARD */
.card { background:var(â€“surface); border:1px solid var(â€“border); border-radius:16px; padding:24px; position:relative; overflow:hidden; transition:border-color 0.3s; }
.card:hover { border-color:rgba(0,212,255,0.3); }
.card-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; padding-bottom:14px; border-bottom:1px solid var(â€“border); }
.card-title { font-family:â€˜Orbitronâ€™,monospace; font-size:12px; font-weight:700; color:var(â€“accent); letter-spacing:2px; text-transform:uppercase; }
.card-badge { font-family:â€˜Share Tech Monoâ€™,monospace; font-size:10px; padding:3px 10px; border-radius:10px; letter-spacing:1px; }
.badge-live { background:rgba(0,255,136,0.15); color:var(â€“green); border:1px solid rgba(0,255,136,0.3); }
.badge-day { background:rgba(0,212,255,0.15); color:var(â€“accent); border:1px solid rgba(0,212,255,0.3); }
.badge-7d { background:rgba(255,140,0,0.15); color:var(â€“orange); border:1px solid rgba(255,140,0,0.3); }

/* INDICATORS */
.indicator-row { display:flex; justify-content:space-between; align-items:center; padding:10px 0; border-bottom:1px solid rgba(255,255,255,0.04); }
.indicator-row:last-child { border-bottom:none; }
.ind-name { font-family:â€˜Share Tech Monoâ€™,monospace; font-size:12px; color:var(â€“text-dim); letter-spacing:1px; }
.ind-val { font-family:â€˜Orbitronâ€™,monospace; font-size:13px; font-weight:700; }
.ind-signal { font-family:â€˜Share Tech Monoâ€™,monospace; font-size:10px; padding:3px 8px; border-radius:8px; letter-spacing:1px; min-width:70px; text-align:center; }
.sig-buy { background:rgba(0,255,136,0.15); color:var(â€“green); }
.sig-sell { background:rgba(255,58,58,0.15); color:var(â€“red); }
.sig-neutral { background:rgba(255,215,0,0.15); color:var(â€“yellow); }

/* CHART */
.chart-wrap { margin:16px 0; }
.chart-wrap svg { width:100%; }
.chart-labels { display:flex; justify-content:space-between; font-family:â€˜Share Tech Monoâ€™,monospace; font-size:10px; color:var(â€“text-dim); margin-top:6px; }

/* LEVELS */
.level-row { display:flex; justify-content:space-between; align-items:center; padding:10px 0; border-bottom:1px solid rgba(255,255,255,0.04); }
.level-row:last-child { border-bottom:none; }
.level-label { font-family:â€˜Share Tech Monoâ€™,monospace; font-size:12px; color:var(â€“text-dim); }
.level-price { font-family:â€˜Orbitronâ€™,monospace; font-size:15px; font-weight:700; }
.level-type { font-family:â€˜Share Tech Monoâ€™,monospace; font-size:10px; padding:3px 8px; border-radius:8px; }
.res { color:var(â€“red); background:rgba(255,58,58,0.1); }
.sup { color:var(â€“green); background:rgba(0,255,136,0.1); }
.cur { color:var(â€“accent); background:rgba(0,212,255,0.1); }

/* SENTIMENT */
.sentiment-bar-bg { height:20px; background:linear-gradient(90deg,#ff3a3a,#ffd700,#00ff88); border-radius:10px; position:relative; margin-bottom:8px; overflow:hidden; }
.sentiment-needle { position:absolute; top:-4px; width:4px; height:28px; background:#fff; border-radius:2px; transform:translateX(-50%); box-shadow:0 0 10px rgba(255,255,255,0.8); transition:left 1s ease; }
.sentiment-labels { display:flex; justify-content:space-between; font-family:â€˜Share Tech Monoâ€™,monospace; font-size:10px; color:var(â€“text-dim); }

/* SCENARIOS */
.scenario-row { display:flex; align-items:center; gap:12px; margin-bottom:14px; }
.scenario-label { font-family:â€˜Share Tech Monoâ€™,monospace; font-size:11px; min-width:90px; }
.scenario-bar-bg { flex:1; height:10px; background:rgba(255,255,255,0.06); border-radius:5px; overflow:hidden; }
.scenario-bar-fill { height:100%; border-radius:5px; transition:width 1.5s ease; }
.sc-neutral { background:linear-gradient(90deg,#ffd700,#ffa500); }
.sc-bull { background:linear-gradient(90deg,#00d4aa,#00ff88); }
.sc-bear { background:linear-gradient(90deg,#cc0000,#ff3a3a); }

/* TIPS */
.tip-row { display:flex; gap:14px; padding:12px 0; border-bottom:1px solid rgba(255,255,255,0.04); align-items:flex-start; }
.tip-row:last-child { border-bottom:none; }
.tip-icon { font-size:18px; flex-shrink:0; width:26px; }
.tip-text { font-size:13px; line-height:1.5; color:var(â€“text); }
.tip-text strong { color:#fff; font-weight:700; }

/* RISK */
.risk-circles { display:flex; gap:8px; margin-top:12px; }
.risk-circle { width:32px; height:32px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-family:â€˜Orbitronâ€™,monospace; font-size:10px; font-weight:900; border:2px solid; }
.rc-filled-red { background:rgba(255,58,58,0.3); border-color:var(â€“red); color:var(â€“red); }
.rc-filled-yellow { background:rgba(255,215,0,0.3); border-color:var(â€“yellow); color:var(â€“yellow); }
.rc-empty { background:transparent; border-color:var(â€“border); color:var(â€“text-dim); }
.risk-label { font-family:â€˜Share Tech Monoâ€™,monospace; font-size:11px; color:var(â€“text-dim); margin-top:8px; letter-spacing:1px; }

/* AI ANALYSIS BOX */
.ai-analysis {
background: linear-gradient(135deg, rgba(0,212,255,0.05), rgba(0,80,170,0.05));
border: 1px solid rgba(0,212,255,0.2);
border-radius:16px; padding:24px; margin-bottom:20px;
animation:fadeUp 0.5s ease both;
}
.ai-header { display:flex; align-items:center; gap:12px; margin-bottom:16px; padding-bottom:14px; border-bottom:1px solid rgba(0,212,255,0.1); }
.ai-tag {
background:linear-gradient(135deg,#00d4ff,#0055cc);
color:#fff; font-family:â€˜Orbitronâ€™,monospace; font-size:10px; font-weight:900;
padding:4px 10px; border-radius:6px; letter-spacing:2px;
}
.ai-title { font-family:â€˜Orbitronâ€™,monospace; font-size:13px; color:var(â€“accent); letter-spacing:2px; }
.ai-body { font-size:14px; line-height:1.7; color:var(â€“text); white-space:pre-wrap; }

/* FOOTER */
footer { border-top:1px solid var(â€“border); padding:20px 0; display:flex; justify-content:space-between; align-items:center; }
.disclaimer { font-family:â€˜Share Tech Monoâ€™,monospace; font-size:10px; color:var(â€“text-dim); letter-spacing:0.5px; }
.footer-brand { font-family:â€˜Orbitronâ€™,monospace; font-size:11px; color:var(â€“text-dim); letter-spacing:2px; }

/* ANIMATIONS */
@keyframes fadeDown { from{opacity:0;transform:translateY(-20px)} to{opacity:1;transform:translateY(0)} }
@keyframes fadeUp { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)} }

/* â€“â€“ HAUPT-CHART â€“â€“ */
.chart-card {
background: var(â€“surface);
border: 1px solid var(â€“border);
border-radius: 16px;
padding: 24px;
margin-bottom: 24px;
animation: fadeUp 0.5s 0.15s ease both;
}
.chart-card-header {
display: flex;
justify-content: space-between;
align-items: flex-start;
margin-bottom: 20px;
flex-wrap: wrap;
gap: 14px;
}
.chart-title-wrap { display: flex; flex-direction: column; gap: 6px; }
.chart-price-live {
display: flex; align-items: center; gap: 12px;
}
.chart-price-live span:first-child {
font-family: â€˜Orbitronâ€™, monospace;
font-size: 24px; font-weight: 900; color: #fff;
}
.chart-price-live .up { color: var(â€“green); font-family:â€˜Orbitronâ€™,monospace; font-size:13px; font-weight:700; }
.chart-price-live .down { color: var(â€“red); font-family:â€˜Orbitronâ€™,monospace; font-size:13px; font-weight:700; }
.chart-controls { display: flex; align-items: center; }
.chart-btn-group {
display: flex; gap: 6px; align-items: center; flex-wrap: wrap;
}
.chart-btn {
background: rgba(255,255,255,0.04);
border: 1px solid var(â€“border);
border-radius: 8px;
color: var(â€“text-dim);
font-family: â€˜Orbitronâ€™, monospace;
font-size: 10px; font-weight: 700;
letter-spacing: 1px;
padding: 7px 12px;
cursor: pointer;
transition: all 0.2s;
white-space: nowrap;
}
.chart-btn:hover {
background: rgba(0,212,255,0.1);
border-color: rgba(0,212,255,0.4);
color: var(â€“accent);
}
.chart-btn.active {
background: rgba(0,212,255,0.15);
border-color: var(â€“accent);
color: var(â€“accent);
box-shadow: 0 0 12px rgba(0,212,255,0.2);
}
.chart-btn.forecast {
border-color: rgba(255,140,0,0.3);
color: var(â€“orange);
}
.chart-btn.forecast:hover, .chart-btn.forecast.active {
background: rgba(255,140,0,0.12);
border-color: var(â€“orange);
color: var(â€“orange);
box-shadow: 0 0 12px rgba(255,140,0,0.2);
}
.chart-btn-divider {
width: 1px; height: 24px;
background: var(â€“border);
margin: 0 4px;
}
.chart-canvas-wrap {
position: relative;
width: 100%;
}
#mainChart { width: 100% !important; display: block; }
.chart-tooltip {
position: absolute;
background: rgba(8,15,30,0.95);
border: 1px solid var(â€“accent);
border-radius: 8px;
padding: 8px 12px;
font-family: â€˜Share Tech Monoâ€™, monospace;
font-size: 11px; color: #fff;
pointer-events: none;
opacity: 0;
transition: opacity 0.15s;
white-space: nowrap;
z-index: 10;
box-shadow: 0 0 20px rgba(0,212,255,0.2);
}
.chart-footer-row {
display: flex; justify-content: space-between; align-items: center;
margin-top: 12px; padding-top: 12px;
border-top: 1px solid var(â€“border);
}
.chart-range-label {
font-family: â€˜Share Tech Monoâ€™, monospace;
font-size: 11px; color: var(â€“text-dim); letter-spacing: 1px;
}
.chart-legend { display: flex; gap: 16px; }
.legend-item {
display: flex; align-items: center; gap: 6px;
font-family: â€˜Share Tech Monoâ€™, monospace;
font-size: 10px; color: var(â€“text-dim);
}
.legend-dot {
width: 10px; height: 3px; border-radius: 2px;
}

/* RESPONSIVE */
@media(max-width:900px){
.main-grid{grid-template-columns:1fr}
.bottom-grid{grid-template-columns:1fr}
.price-hero{grid-template-columns:1fr;text-align:center}
.price-value{font-size:38px}
header{flex-direction:column;gap:12px;text-align:center}
.header-right{justify-content:center}
.selector-bar{flex-direction:column;align-items:flex-start}
.chart-card-header{flex-direction:column}
.chart-btn-group{justify-content:flex-start}
}

/* â€“â€“ LOGIN SCREEN â€“â€“ */
#loginScreen {
position: fixed;
inset: 0;
background: var(â€“bg);
z-index: 9999;
display: flex;
align-items: center;
justify-content: center;
flex-direction: column;
transition: opacity 0.4s ease;
}
#loginScreen.hidden {
opacity: 0 !important;
pointer-events: none !important;
display: none !important;
}
#loginScreen::before {
content:â€™â€™;
position:fixed; inset:0;
background-image:
linear-gradient(rgba(0,212,255,0.04) 1px,transparent 1px),
linear-gradient(90deg,rgba(0,212,255,0.04) 1px,transparent 1px);
background-size:50px 50px;
animation:gridMove 20s linear infinite;
pointer-events:none;
}
.login-box {
background: var(â€“surface);
border: 1px solid rgba(0,212,255,0.25);
border-radius: 20px;
padding: 48px 44px;
width: 100%;
max-width: 420px;
position: relative;
z-index: 1;
box-shadow: 0 0 60px rgba(0,212,255,0.1), 0 0 120px rgba(0,80,170,0.08);
animation: fadeUp 0.6s ease both;
}
.login-logo {
text-align: center;
margin-bottom: 36px;
}
.login-logo-icon {
width: 64px; height: 64px;
background: linear-gradient(135deg, #00d4ff, #0050aa);
border-radius: 16px;
display: inline-flex; align-items: center; justify-content: center;
font-family: â€˜Orbitronâ€™, monospace; font-weight: 900; font-size: 20px; color: #fff;
box-shadow: 0 0 30px rgba(0,212,255,0.4);
margin-bottom: 16px;
position: relative; overflow: hidden;
}
.login-logo-icon::after {
content: â€˜â€™; position: absolute; top: -50%; left: -50%;
width: 200%; height: 200%;
background: linear-gradient(transparent, rgba(255,255,255,0.12), transparent);
animation: shine 3s infinite;
}
.login-title {
font-family: â€˜Orbitronâ€™, monospace;
font-size: 20px; font-weight: 900; color: #fff;
letter-spacing: 3px; margin-bottom: 6px;
}
.login-sub {
font-family: â€˜Share Tech Monoâ€™, monospace;
font-size: 11px; color: var(â€“accent); letter-spacing: 2px;
}
.login-divider {
height: 1px; background: var(â€“border); margin: 0 0 28px;
}
.login-field {
margin-bottom: 18px;
}
.login-label {
font-family: â€˜Share Tech Monoâ€™, monospace;
font-size: 10px; color: var(â€“text-dim);
letter-spacing: 2px; text-transform: uppercase;
display: block; margin-bottom: 8px;
}
.login-input-wrap {
position: relative;
}
.login-input {
width: 100%;
background: rgba(0,212,255,0.05);
border: 1px solid var(â€“border);
border-radius: 10px;
color: #fff;
font-family: â€˜Share Tech Monoâ€™, monospace;
font-size: 14px;
padding: 12px 16px 12px 42px;
outline: none;
transition: all 0.3s;
letter-spacing: 1px;
}
.login-input:focus {
border-color: var(â€“accent);
background: rgba(0,212,255,0.08);
box-shadow: 0 0 20px rgba(0,212,255,0.15);
}
.login-input::placeholder { color: var(â€“text-dim); }
.login-input-icon {
position: absolute; left: 14px; top: 50%;
transform: translateY(-50%);
color: var(â€“text-dim); font-size: 14px;
pointer-events: none;
}
.login-btn {
width: 100%;
background: linear-gradient(135deg, #00d4ff, #0055cc);
border: none; border-radius: 10px;
color: #fff;
font-family: â€˜Orbitronâ€™, monospace;
font-size: 13px; font-weight: 700;
letter-spacing: 3px;
padding: 14px;
cursor: pointer;
margin-top: 8px;
box-shadow: 0 0 20px rgba(0,212,255,0.3);
transition: all 0.3s;
position: relative; overflow: hidden;
}
.login-btn:hover {
transform: translateY(-2px);
box-shadow: 0 0 40px rgba(0,212,255,0.5);
}
.login-btn:active { transform: translateY(0); }
.login-btn::after {
content: â€˜â€™;
position: absolute; inset: 0;
background: linear-gradient(transparent, rgba(255,255,255,0.1), transparent);
transform: translateX(-100%) skewX(-15deg);
transition: transform 0.5s;
}
.login-btn:hover::after { transform: translateX(150%) skewX(-15deg); }
.login-error {
background: rgba(255,58,58,0.1);
border: 1px solid rgba(255,58,58,0.4);
border-radius: 8px;
padding: 10px 14px;
font-family: â€˜Share Tech Monoâ€™, monospace;
font-size: 12px; color: var(â€“red);
letter-spacing: 1px;
margin-top: 14px;
display: none;
animation: shake 0.4s ease;
}
.login-error.show { display: block; }
@keyframes shake {
0%,100%{transform:translateX(0)}
20%{transform:translateX(-8px)}
40%{transform:translateX(8px)}
60%{transform:translateX(-5px)}
80%{transform:translateX(5px)}
}
.login-footer {
text-align: center;
margin-top: 24px;
font-family: â€˜Share Tech Monoâ€™, monospace;
font-size: 10px; color: var(â€“text-dim);
letter-spacing: 1px;
}
.login-screen-hidden { display: none !important; }

/* Logout button in header */
.logout-btn {
background: rgba(255,58,58,0.1);
border: 1px solid rgba(255,58,58,0.3);
border-radius: 8px;
color: var(â€“red);
font-family: â€˜Share Tech Monoâ€™, monospace;
font-size: 11px; letter-spacing: 1px;
padding: 6px 14px;
cursor: pointer;
transition: all 0.2s;
}
.logout-btn:hover {
background: rgba(255,58,58,0.2);
border-color: var(â€“red);
}
.user-badge {
display: inline-flex; align-items: center; gap: 8px;
background: rgba(0,212,255,0.08);
border: 1px solid rgba(0,212,255,0.2);
border-radius: 8px;
padding: 5px 12px;
font-family: â€˜Share Tech Monoâ€™, monospace;
font-size: 11px; color: var(â€“accent);
letter-spacing: 1px;
}
.user-dot {
width: 6px; height: 6px; border-radius: 50%;
background: var(â€“green);
animation: pulse 2s infinite;
}
/* â”€â”€ NAV TABS â”€â”€ */
.nav-tabs {
display:flex; gap:4px; padding:0 20px;
background:var(â€“surface); border-bottom:1px solid var(â€“border);
position:sticky; top:0; z-index:50;
max-width:100%; overflow-x:auto;
}
.nav-tab {
padding:12px 24px; font-family:â€˜Orbitronâ€™,monospace; font-size:11px;
font-weight:700; letter-spacing:2px; color:var(â€“text-dim);
border:none; background:none; cursor:pointer;
border-bottom:3px solid transparent; transition:all 0.2s;
white-space:nowrap;
}
.nav-tab:hover { color:var(â€“accent); }
.nav-tab.active { color:var(â€“accent); border-bottom-color:var(â€“accent); }

/* â”€â”€ PORTFOLIO PAGE â”€â”€ */
.page { display:none; }
.page.active { display:block; }

.portfolio-grid { display:grid; grid-template-columns:380px 1fr; gap:20px; margin-bottom:20px; }
.portfolio-input-card { background:var(â€“surface); border:1px solid var(â€“border); border-radius:16px; padding:24px; }
.portfolio-input-card h3 { font-family:â€˜Orbitronâ€™,monospace; font-size:13px; color:var(â€“accent); margin-bottom:18px; letter-spacing:2px; }

.coin-input-row { display:flex; align-items:center; gap:8px; margin-bottom:10px; animation:fadeIn 0.3s ease; }
.coin-input-row select {
flex:1; background:var(â€“surface2); border:1px solid var(â€“border);
color:var(â€“text); padding:8px 10px; border-radius:8px;
font-family:â€˜Share Tech Monoâ€™,monospace; font-size:12px;
}
.coin-input-row input {
width:100px; background:var(â€“surface2); border:1px solid var(â€“border);
color:var(â€“accent); padding:8px 10px; border-radius:8px;
font-family:â€˜Orbitronâ€™,monospace; font-size:12px; text-align:right;
}
.coin-input-row input:focus, .coin-input-row select:focus {
outline:none; border-color:var(â€“accent); box-shadow:0 0 8px rgba(0,212,255,0.2);
}
.remove-btn {
width:28px; height:28px; border-radius:6px; border:1px solid var(â€“border);
background:rgba(255,58,58,0.1); color:var(â€“red); cursor:pointer;
font-size:14px; display:flex; align-items:center; justify-content:center;
transition:all 0.2s;
}
.remove-btn:hover { background:rgba(255,58,58,0.3); }

.add-coin-btn {
width:100%; padding:10px; background:rgba(0,212,255,0.05);
border:1px dashed var(â€“border); border-radius:8px; color:var(â€“text-dim);
font-family:â€˜Share Tech Monoâ€™,monospace; font-size:12px; cursor:pointer;
transition:all 0.2s; margin-top:4px;
}
.add-coin-btn:hover { border-color:var(â€“accent); color:var(â€“accent); }

.horizon-btns { display:flex; gap:8px; margin:16px 0; }
.horizon-btn {
flex:1; padding:10px; border-radius:8px; border:1px solid var(â€“border);
background:var(â€“surface2); color:var(â€“text-dim); cursor:pointer;
font-family:â€˜Orbitronâ€™,monospace; font-size:11px; font-weight:700;
letter-spacing:1px; transition:all 0.2s;
}
.horizon-btn.active {
background:rgba(0,212,255,0.15); border-color:var(â€“accent);
color:var(â€“accent); box-shadow:0 0 12px rgba(0,212,255,0.2);
}

.analyze-portfolio-btn {
width:100%; padding:14px; border-radius:10px; border:none;
background:linear-gradient(135deg,#00d4ff,#0050aa);
color:#fff; font-family:â€˜Orbitronâ€™,monospace; font-size:13px;
font-weight:700; letter-spacing:2px; cursor:pointer;
box-shadow:var(â€“glow); transition:all 0.3s; margin-top:8px;
}
.analyze-portfolio-btn:hover { transform:translateY(-2px); box-shadow:0 0 30px rgba(0,212,255,0.5); }
.analyze-portfolio-btn:disabled { opacity:0.5; cursor:not-allowed; transform:none; }

/* â”€â”€ ERGEBNIS-KARTEN â”€â”€ */
.advice-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(300px,1fr)); gap:16px; margin-bottom:20px; }
.advice-card {
background:var(â€“surface); border:1px solid var(â€“border); border-radius:14px;
padding:20px; position:relative; overflow:hidden; transition:all 0.3s;
animation:fadeIn 0.4s ease both;
}
.advice-card:hover { transform:translateY(-3px); box-shadow:var(â€“glow); }
.advice-card.hold  { border-color:rgba(255,215,0,0.3); }
.advice-card.swap  { border-color:rgba(0,255,136,0.3); }
.advice-card.sell  { border-color:rgba(255,58,58,0.3); }
.advice-card::before {
content:â€™â€™; position:absolute; top:0; left:0; right:0; height:3px;
}
.advice-card.hold::before  { background:var(â€“yellow); }
.advice-card.swap::before  { background:var(â€“green); }
.advice-card.sell::before  { background:var(â€“red); }

.advice-action {
display:inline-flex; align-items:center; gap:6px;
padding:4px 12px; border-radius:20px; font-family:â€˜Orbitronâ€™,monospace;
font-size:10px; font-weight:700; letter-spacing:1px; margin-bottom:12px;
}
.advice-action.hold  { background:rgba(255,215,0,0.15); color:var(â€“yellow); border:1px solid rgba(255,215,0,0.3); }
.advice-action.swap  { background:rgba(0,255,136,0.15); color:var(â€“green);  border:1px solid rgba(0,255,136,0.3); }
.advice-action.sell  { background:rgba(255,58,58,0.15);  color:var(â€“red);   border:1px solid rgba(255,58,58,0.3); }

.advice-coin-row { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:10px; }
.advice-coin-name { font-family:â€˜Orbitronâ€™,monospace; font-size:16px; font-weight:900; color:#fff; }
.advice-arrow { font-size:22px; margin:4px 0; }
.advice-target { font-family:â€˜Orbitronâ€™,monospace; font-size:14px; color:var(â€“green); }
.advice-potential {
font-family:â€˜Orbitronâ€™,monospace; font-size:22px; font-weight:900;
margin:8px 0;
}
.advice-potential.pos { color:var(â€“green); }
.advice-potential.neg { color:var(â€“red); }
.advice-potential.neu { color:var(â€“yellow); }

.advice-meta { display:flex; gap:16px; margin:10px 0; flex-wrap:wrap; }
.advice-meta-item { font-family:â€˜Share Tech Monoâ€™,monospace; font-size:11px; color:var(â€“text-dim); }
.advice-meta-item strong { color:var(â€“text); }

.advice-reason { font-size:13px; color:var(â€“text); line-height:1.6; margin-top:10px; border-top:1px solid var(â€“border); padding-top:10px; }

.confidence-bar-wrap { margin-top:10px; }
.confidence-bar-wrap label { font-family:â€˜Share Tech Monoâ€™,monospace; font-size:10px; color:var(â€“text-dim); }
.confidence-bar { height:4px; background:var(â€“surface2); border-radius:2px; margin-top:4px; }
.confidence-fill { height:100%; border-radius:2px; transition:width 1s ease; }

/* Summary Row */
.portfolio-summary {
background:var(â€“surface); border:1px solid var(â€“border); border-radius:14px;
padding:20px; margin-bottom:20px; display:grid;
grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); gap:16px;
}
.summary-stat { text-align:center; }
.summary-stat-val { font-family:â€˜Orbitronâ€™,monospace; font-size:22px; font-weight:900; }
.summary-stat-lbl { font-family:â€˜Share Tech Monoâ€™,monospace; font-size:10px; color:var(â€“text-dim); margin-top:4px; letter-spacing:1px; }

.ai-full-advice { background:var(â€“surface); border:1px solid rgba(0,212,255,0.2); border-radius:14px; padding:24px; margin-bottom:20px; }
.ai-full-advice h3 { font-family:â€˜Orbitronâ€™,monospace; font-size:13px; color:var(â€“accent); margin-bottom:14px; letter-spacing:2px; }
.ai-full-advice pre { white-space:pre-wrap; font-family:â€˜Share Tech Monoâ€™,monospace; font-size:13px; line-height:1.8; color:var(â€“text); }

.portfolio-empty { text-align:center; padding:60px 20px; color:var(â€“text-dim); font-family:â€˜Share Tech Monoâ€™,monospace; }
.portfolio-empty .empty-icon { font-size:48px; margin-bottom:16px; }

@media(max-width:900px) { .portfolio-grid { grid-template-columns:1fr; } }
@keyframes fadeIn { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }
.ob-grid { display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:20px; }
.ob-pressure-bar-wrap { display:flex; align-items:center; gap:10px; margin:16px 0 8px; }
.ob-pressure-bar { flex:1; height:14px; background:var(â€“surface2); border-radius:7px; overflow:hidden; }
.ob-bid-fill { height:100%; background:linear-gradient(90deg,var(â€“green),#00ff8888); border-radius:7px; transition:width 0.8s ease; }
.ob-label-buy { font-family:â€˜Orbitronâ€™,monospace; font-size:10px; color:var(â€“green); }
.ob-label-ask { font-family:â€˜Orbitronâ€™,monospace; font-size:10px; color:var(â€“red); }
.ob-pct-row { display:flex; justify-content:space-between; align-items:center; margin-bottom:14px; }
.ob-rows { border-top:1px solid var(â€“border); padding-top:10px; }
.ob-row { display:grid; grid-template-columns:1fr auto 1fr; gap:8px; padding:5px 0; font-family:â€˜Share Tech Monoâ€™,monospace; font-size:12px; border-bottom:1px solid rgba(255,255,255,0.04); }
.ob-header { font-size:10px; color:var(â€“text-dim); border-bottom:1px solid var(â€“border) !important; padding-bottom:6px !important; }
.ob-row .ob-bid-val { color:var(â€“green); text-align:left; }
.ob-row .ob-price-val { color:var(â€“accent); text-align:center; font-weight:700; }
.ob-row .ob-ask-val { color:var(â€“red); text-align:right; }
@media(max-width:768px){ .ob-grid{grid-template-columns:1fr} }
</style>

</head>
<body>

<!-- ====== LOGIN SCREEN ====== -->

<div id="loginScreen">
  <div class="login-box">
    <div class="login-logo">
      <div class="login-logo-icon">â—ˆ</div>
      <div class="login-title">CRYPTO SIGNAL</div>
      <div class="login-sub">DAYTRADER DASHBOARD Â· SECURE ACCESS</div>
    </div>
    <div class="login-divider"></div>

```
<div class="login-field">
  <label class="login-label" for="loginUser">â–¸ Benutzername</label>
  <div class="login-input-wrap">
    <span class="login-input-icon">ğŸ‘¤</span>
    <input class="login-input" type="text" id="loginUser" placeholder="Username eingeben" autocomplete="username" />
  </div>
</div>

<div class="login-field">
  <label class="login-label" for="loginPass">â–¸ Passwort</label>
  <div class="login-input-wrap">
    <span class="login-input-icon">ğŸ”’</span>
    <input class="login-input" type="password" id="loginPass" placeholder="Passwort eingeben" autocomplete="current-password" />
  </div>
</div>

<button class="login-btn" onclick="doLogin()">âš¡ EINLOGGEN</button>

<div class="login-error" id="loginError">
  âœ• &nbsp; UNGÃœLTIGE ZUGANGSDATEN
</div>

<div class="login-footer">
  CRYPTO SIGNAL DASHBOARD Â· ZUGANG NUR FÃœR AUTORISIERTE NUTZER
</div>
```

  </div>
</div>

<!-- ====== DASHBOARD (verborgen bis Login) ====== -->

<div id="dashboardWrapper" style="display:none;">
<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-spinner"></div>
  <div class="loading-text">ANALYSE LÃ„UFT</div>
  <div class="loading-sub" id="loadingSub">KI analysiert Marktdaten...</div>
</div>

<div class="container">
  <header>
    <div class="logo">
      <div class="logo-icon" id="logoIcon">â—ˆ</div>
      <div>
        <h1 id="dashTitle">CRYPTO SIGNAL</h1>
        <p>KI-Powered Daytrader Dashboard</p>
      </div>
    </div>
    <div class="header-right">
      <div class="user-badge" id="userBadge"><span class="user-dot"></span>ADMIN</div>
      <div class="live-badge"><div class="live-dot"></div>KI ANALYSE</div>
      <div class="timestamp" id="timestamp"></div>
      <button class="logout-btn" onclick="doLogout()">â» LOGOUT</button>
    </div>
  </header>
</div>

<!-- NAV TABS -->

<div class="nav-tabs" id="navTabs">
  <button class="nav-tab active" onclick="switchPage('dashboard', this)">âš¡ DASHBOARD</button>
  <button class="nav-tab" onclick="switchPage('portfolio', this)">â—ˆ PORTFOLIO ADVISOR</button>
</div>

<!-- ====== PAGE: DASHBOARD ====== -->

<div class="page active" id="pageDashboard">
<div class="selector-bar">
  <span class="selector-label">COIN AUSWÃ„HLEN:</span>
  <div class="coin-select-wrap">
    <select class="coin-select" id="coinSelect">
      <optgroup label="â”€â”€ Top Coins â”€â”€">
        <option value="BTC" data-name="Bitcoin" data-symbol="â‚¿">â‚¿ BTC â€“ Bitcoin</option>
        <option value="ETH" data-name="Ethereum" data-symbol="Î">Î ETH â€“ Ethereum</option>
        <option value="XRP" selected data-name="XRP / Ripple" data-symbol="âœ•">âœ• XRP â€“ Ripple</option>
        <option value="BNB" data-name="BNB" data-symbol="â—ˆ">â—ˆ BNB â€“ Binance Coin</option>
        <option value="SOL" data-name="Solana" data-symbol="â—">â— SOL â€“ Solana</option>
        <option value="ADA" data-name="Cardano" data-symbol="â‚³">â‚³ ADA â€“ Cardano</option>
        <option value="AVAX" data-name="Avalanche" data-symbol="â–³">â–³ AVAX â€“ Avalanche</option>
        <option value="DOGE" data-name="Dogecoin" data-symbol="Ã">Ã DOGE â€“ Dogecoin</option>
        <option value="DOT" data-name="Polkadot" data-symbol="â—">â— DOT â€“ Polkadot</option>
        <option value="LINK" data-name="Chainlink" data-symbol="â¬¡">â¬¡ LINK â€“ Chainlink</option>
      </optgroup>
      <optgroup label="â”€â”€ DeFi / Layer 2 â”€â”€">
        <option value="MATIC" data-name="Polygon" data-symbol="â¬Ÿ">â¬Ÿ MATIC â€“ Polygon</option>
        <option value="UNI" data-name="Uniswap" data-symbol="ğŸ¦„">ğŸ¦„ UNI â€“ Uniswap</option>
        <option value="ATOM" data-name="Cosmos" data-symbol="âš›">âš› ATOM â€“ Cosmos</option>
        <option value="LTC" data-name="Litecoin" data-symbol="Å">Å LTC â€“ Litecoin</option>
        <option value="NEAR" data-name="NEAR Protocol" data-symbol="â“ƒ">â“ƒ NEAR â€“ NEAR Protocol</option>
        <option value="ARB" data-name="Arbitrum" data-symbol="â–²">â–² ARB â€“ Arbitrum</option>
        <option value="OP" data-name="Optimism" data-symbol="ğŸ”´">ğŸ”´ OP â€“ Optimism</option>
        <option value="SUI" data-name="Sui" data-symbol="â—†">â—† SUI â€“ Sui</option>
      </optgroup>
      <optgroup label="â”€â”€ Meme Coins â”€â”€">
        <option value="SHIB" data-name="Shiba Inu" data-symbol="ğŸ•">ğŸ• SHIB â€“ Shiba Inu</option>
        <option value="PEPE" data-name="Pepe" data-symbol="ğŸ¸">ğŸ¸ PEPE â€“ Pepe Coin</option>
        <option value="FLOKI" data-name="Floki" data-symbol="ğŸ¶">ğŸ¶ FLOKI â€“ Floki Inu</option>
      </optgroup>
    </select>
    <span class="select-arrow">â–¼</span>
  </div>

  <button class="analyze-btn" id="analyzeBtn" onclick="runAnalysis()">
    âš¡ ANALYSE STARTEN
  </button>

  <div class="coin-chips">
    <div class="chip active" onclick="quickSelect('XRP')">XRP</div>
    <div class="chip" onclick="quickSelect('BTC')">BTC</div>
    <div class="chip" onclick="quickSelect('ETH')">ETH</div>
    <div class="chip" onclick="quickSelect('SOL')">SOL</div>
    <div class="chip" onclick="quickSelect('DOGE')">DOGE</div>
    <div class="chip" onclick="quickSelect('BNB')">BNB</div>
  </div>
</div>

<!-- TICKER -->

<div class="ticker-wrap">
  <div class="ticker-content" id="tickerContent">
    <span class="ticker-item"><span class="tk-sym">BTC</span> <span>â€“</span> <span>â€“</span></span>
    <span class="ticker-item"><span class="tk-sym">ETH</span> <span>â€“</span> <span>â€“</span></span>
    <span class="ticker-item"><span class="tk-sym">XRP</span> <span>â€“</span> <span>â€“</span></span>
    <span class="ticker-item"><span class="tk-sym">SOL</span> <span>â€“</span> <span>â€“</span></span>
    <span class="ticker-item"><span class="tk-sym">BNB</span> <span>â€“</span> <span>â€“</span></span>
    <span class="ticker-item"><span class="tk-sym">ADA</span> <span>â€“</span> <span>â€“</span></span>
    <span class="ticker-item"><span class="tk-sym">DOGE</span> <span>â€“</span> <span>â€“</span></span>
    <span class="ticker-item"><span class="tk-sym">FEAR & GREED</span> <span>wird geladen...</span></span>
    <span class="ticker-item"><span class="tk-sym">MARKTCAP GESAMT</span> <span>wird geladen...</span></span>
    <!-- repeat -->
    <span class="ticker-item"><span class="tk-sym">BTC</span> <span>â€“</span> <span>â€“</span></span>
    <span class="ticker-item"><span class="tk-sym">ETH</span> <span>â€“</span> <span>â€“</span></span>
    <span class="ticker-item"><span class="tk-sym">XRP</span> <span>â€“</span> <span>â€“</span></span>
    <span class="ticker-item"><span class="tk-sym">SOL</span> <span>â€“</span> <span>â€“</span></span>
    <span class="ticker-item"><span class="tk-sym">BNB</span> <span>â€“</span> <span>â€“</span></span>
    <span class="ticker-item"><span class="tk-sym">FEAR & GREED</span> <span>wird geladen...</span></span>
    <span class="ticker-item"><span class="tk-sym">MARKTCAP GESAMT</span> <span>wird geladen...</span></span>
  </div>
</div>

<div class="container" id="dashboardContent">

  <!-- PRICE HERO -->

  <div class="price-hero" style="margin-top:24px;" id="priceHero">
    <div class="current-price">
      <div class="price-label">AKTUELLER KURS</div>
      <div class="price-value" id="priceValue">â€“</div>
      <div class="price-change up" id="priceChange">Wird geladen...</div>
    </div>
    <div class="stats-grid">
      <div class="stat-box"><div class="stat-label">24H HOCH</div><div class="stat-val" id="stat24hH">â€“</div></div>
      <div class="stat-box"><div class="stat-label">24H TIEF</div><div class="stat-val" id="stat24hL">â€“</div></div>
      <div class="stat-box"><div class="stat-label">7D PERF.</div><div class="stat-val" id="stat7d">â€“</div></div>
      <div class="stat-box"><div class="stat-label">30D PERF.</div><div class="stat-val" id="stat30d">â€“</div></div>
    </div>
    <div class="signal-box neutral" id="signalBox">
      <div class="signal-label">DAYTRADER SIGNAL</div>
      <div class="signal-value" id="signalValue">HALTEN</div>
      <div class="signal-sub" id="signalSub">Vorsichtiges Abwarten</div>
      <div class="signal-confidence" id="signalConf">âš¡ Konfidenz: 65% Â· NEUTRAL</div>
    </div>
    <div class="price-hero-bg" id="heroBg">XRP</div>
  </div>

  <!-- ====== HAUPT-CHART ====== -->

  <div class="chart-card" id="mainChartCard">
    <div class="chart-card-header">
      <div class="chart-title-wrap">
        <span class="card-title" id="chartCardTitle">XRP / USD Â· KURSCHART</span>
        <div class="chart-price-live">
          <span id="chartLivePrice">â€“</span>
          <span id="chartLiveChange" class="up">â€“</span>
        </div>
      </div>
      <div class="chart-controls">
        <div class="chart-btn-group" id="chartBtnGroup">
          <button class="chart-btn" data-range="3d" onclick="setChartRange('3d')">3T</button>
          <button class="chart-btn active" data-range="7d" onclick="setChartRange('7d')">7T</button>
          <button class="chart-btn" data-range="30d" onclick="setChartRange('30d')">30T</button>
          <button class="chart-btn" data-range="3m" onclick="setChartRange('3m')">3M</button>
          <button class="chart-btn" data-range="1y" onclick="setChartRange('1y')">1J</button>
          <button class="chart-btn" data-range="5y" onclick="setChartRange('5y')">5J</button>
          <div class="chart-btn-divider"></div>
          <button class="chart-btn forecast" data-range="f24h" onclick="setChartRange('f24h')">âš¡ 24H</button>
          <button class="chart-btn forecast" data-range="f3d" onclick="setChartRange('f3d')">âš¡ 3T</button>
          <button class="chart-btn forecast" data-range="f7d" onclick="setChartRange('f7d')">âš¡ 7T</button>
        </div>
      </div>
    </div>
    <div class="chart-canvas-wrap">
      <canvas id="mainChart" height="280"></canvas>
      <div class="chart-tooltip" id="chartTooltip"></div>
    </div>
    <div class="chart-footer-row">
      <span class="chart-range-label" id="chartRangeLabel">Zeitraum: letzte 7 Tage</span>
      <div class="chart-legend">
        <span class="legend-item"><span class="legend-dot" style="background:var(--accent)"></span>Kurs</span>
        <span class="legend-item forecast-legend" id="forecastLegend" style="display:none"><span class="legend-dot" style="background:#ff8c00;border:2px dashed #ff8c00;background:transparent"></span>Prognose</span>
      </div>
    </div>
  </div>

  <!-- KI ANALYSE BOX -->

  <div class="ai-analysis" id="aiAnalysisBox">
    <div class="ai-header">
      <span class="ai-tag">KI</span>
      <span class="ai-title" id="aiTitle">â€“ DAYTRADER ANALYSE WIRD GELADEN â€“</span>
    </div>
    <div class="ai-body" id="aiBody">Analyse wird generiert...</div>
  </div>

  <!-- MAIN GRID -->

  <div class="main-grid">
    <div class="card">
      <div class="card-header">
        <span class="card-title" id="indTitle">Technische Indikatoren Â· XRP</span>
        <span class="card-badge badge-live">LIVE</span>
      </div>
      <div class="chart-wrap">
        <svg viewBox="0 0 600 120" xmlns="http://www.w3.org/2000/svg" id="miniChart">
          <defs>
            <linearGradient id="chartGrad" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="#00d4ff" stop-opacity="0.3"/>
              <stop offset="100%" stop-color="#00d4ff" stop-opacity="0"/>
            </linearGradient>
          </defs>
          <line x1="0" y1="95" x2="600" y2="95" stroke="#00ff88" stroke-width="1" stroke-dasharray="4,4" opacity="0.4"/>
          <line x1="0" y1="30" x2="600" y2="30" stroke="#ff3a3a" stroke-width="1" stroke-dasharray="4,4" opacity="0.4"/>
          <path id="chartArea" d="M0,60 C30,65 60,80 100,85 C140,90 170,95 200,88 C230,80 260,70 290,65 C320,60 350,50 380,45 C410,40 440,55 470,62 C500,68 530,58 560,50 L560,120 L0,120 Z" fill="url(#chartGrad)" opacity="0.6"/>
          <path id="chartLine" d="M0,60 C30,65 60,80 100,85 C140,90 170,95 200,88 C230,80 260,70 290,65 C320,60 350,50 380,45 C410,40 440,55 470,62 C500,68 530,58 560,50" fill="none" stroke="#00d4ff" stroke-width="2.5"/>
          <circle id="chartDot" cx="560" cy="50" r="5" fill="#00d4ff"/>
          <circle cx="560" cy="50" r="10" fill="none" stroke="#00d4ff" opacity="0.3">
            <animate attributeName="r" values="5;14;5" dur="2s" repeatCount="indefinite"/>
            <animate attributeName="opacity" values="0.5;0;0.5" dur="2s" repeatCount="indefinite"/>
          </circle>
          <text id="chartSupText" x="2" y="112" font-family="Share Tech Mono" font-size="9" fill="#00ff88" opacity="0.7">SUPPORT</text>
          <text id="chartResText" x="2" y="28" font-family="Share Tech Mono" font-size="9" fill="#ff3a3a" opacity="0.7">WIDERSTAND</text>
          <text id="chartPriceText" x="565" y="48" font-family="Share Tech Mono" font-size="9" fill="#00d4ff">â€“</text>
        </svg>
        <div class="chart-labels"><span id="cl1">â€“</span><span id="cl2">â€“</span><span id="cl3">â€“</span><span>Heute</span></div>
      </div>
      <div id="indicatorsTable">
        <div class="indicator-row"><span class="ind-name">RSI (14)</span><span class="ind-val" style="color:var(--yellow)">34.77</span><span class="ind-signal sig-neutral">NEUTRAL</span></div>
        <div class="indicator-row"><span class="ind-name">MACD (12,26)</span><span class="ind-val" style="color:var(--red)">âˆ’0.155</span><span class="ind-signal sig-sell">BÃ„RISCH</span></div>
        <div class="indicator-row"><span class="ind-name">Williams %R</span><span class="ind-val" style="color:var(--green)">âˆ’89.11</span><span class="ind-signal sig-buy">ÃœBERVERKAUFT</span></div>
        <div class="indicator-row"><span class="ind-name">MA 5 (SMA)</span><span class="ind-val" style="color:var(--red)">$1.73</span><span class="ind-signal sig-sell">SELL</span></div>
        <div class="indicator-row"><span class="ind-name">MA 50 (SMA)</span><span class="ind-val" style="color:var(--red)">$1.95</span><span class="ind-signal sig-sell">SELL</span></div>
        <div class="indicator-row"><span class="ind-name">Bollinger Bands</span><span class="ind-val" style="color:var(--yellow)">0.1745</span><span class="ind-signal sig-neutral">UNTEN</span></div>
        <div class="indicator-row"><span class="ind-name">Volumen (24H)</span><span class="ind-val" style="color:var(--accent)">$2.48 Mrd</span><span class="ind-signal sig-neutral">NORMAL</span></div>
      </div>
    </div>

```
<div style="display:flex;flex-direction:column;gap:20px;">
  <div class="card">
    <div class="card-header"><span class="card-title">Kurszonen</span><span class="card-badge badge-day">DAYTRADING</span></div>
    <div id="levelsTable">
      <div class="level-row"><span class="level-label" colspan="3" style="color:var(--text-dim);font-family:'Share Tech Mono',monospace;font-size:11px;">Wird geladen...</span></div>
    </div>
  </div>
  <div class="card">
    <div class="card-header"><span class="card-title">Risiko-Level</span><span class="card-badge badge-7d">7 TAGE</span></div>
    <div class="risk-circles" id="riskCircles">
      <div class="risk-circle rc-filled-red">!</div>
      <div class="risk-circle rc-filled-red">!</div>
      <div class="risk-circle rc-filled-red">!</div>
      <div class="risk-circle rc-filled-yellow">~</div>
      <div class="risk-circle rc-empty">Â·</div>
    </div>
    <div class="risk-label" id="riskLabel">HOCH (3/5) Â· VORSICHT BEI HEBEL</div>
    <div style="margin-top:14px;font-size:13px;color:var(--text);line-height:1.6;" id="riskText">
      Analyse wird geladen...
    </div>
  </div>
</div>
```

  </div>

  <!-- BOTTOM GRID -->

  <div class="bottom-grid">
    <div class="card">
      <div class="card-header"><span class="card-title">Szenarien 7 Tage</span><span class="card-badge badge-7d">PROGNOSE</span></div>
      <div class="scenario-row">
        <span class="scenario-label" style="color:var(--yellow)">â¡ NEUTRAL</span>
        <div class="scenario-bar-bg"><div class="scenario-bar-fill sc-neutral" id="scNeutral" style="width:45%"></div></div>
        <span class="scenario-pct" style="color:var(--yellow)" id="scNeutralPct">45%</span>
      </div>
      <div style="font-size:12px;color:var(--text-dim);margin-bottom:14px;font-family:'Share Tech Mono',monospace;" id="scNeutralText">Wird geladen...</div>
      <div class="scenario-row">
        <span class="scenario-label" style="color:var(--green)">ğŸ‚ BULLISCH</span>
        <div class="scenario-bar-bg"><div class="scenario-bar-fill sc-bull" id="scBull" style="width:35%"></div></div>
        <span class="scenario-pct" style="color:var(--green)" id="scBullPct">35%</span>
      </div>
      <div style="font-size:12px;color:var(--text-dim);margin-bottom:14px;font-family:'Share Tech Mono',monospace;" id="scBullText">Wird geladen...</div>
      <div class="scenario-row">
        <span class="scenario-label" style="color:var(--red)">ğŸ» BÃ„RISCH</span>
        <div class="scenario-bar-bg"><div class="scenario-bar-fill sc-bear" id="scBear" style="width:20%"></div></div>
        <span class="scenario-pct" style="color:var(--red)" id="scBearPct">20%</span>
      </div>
      <div style="font-size:12px;color:var(--text-dim);font-family:'Share Tech Mono',monospace;" id="scBearText">Wird geladen...</div>
    </div>

```
<div class="card">
  <div class="card-header"><span class="card-title">Markt-Sentiment</span><span class="card-badge badge-live">LIVE</span></div>
  <div style="margin-bottom:6px;font-family:'Share Tech Mono',monospace;font-size:11px;color:var(--text-dim);">ANGST / GIER INDEX</div>
  <div style="height:20px;background:linear-gradient(90deg,#ff3a3a,#ffd700,#00ff88);border-radius:10px;position:relative;margin-bottom:8px;">
    <div class="sentiment-needle" id="fearNeedle" style="left:50%"></div>
  </div>
  <div class="sentiment-labels"><span>EXTREME ANGST</span><span>NEUTRAL</span><span>GIER</span></div>
  <div style="text-align:center;margin:14px 0;">
    <span style="font-family:'Orbitron',monospace;font-size:28px;font-weight:900;color:var(--yellow);" id="fearScore">â€“</span>
    <span style="font-family:'Share Tech Mono',monospace;font-size:12px;color:var(--yellow);margin-left:8px;" id="fearLabel">WIRD GELADEN</span>
  </div>
  <div style="border-top:1px solid var(--border);padding-top:14px;" id="sentimentRows">
    <div class="indicator-row"><span class="ind-name">News-Sentiment</span><span class="ind-val" id="sentNews">â€“</span><span class="ind-signal sig-neutral" id="sentNewsSig">LÃ„DT</span></div>
    <div class="indicator-row"><span class="ind-name">Marktkapitalisierung</span><span class="ind-val" id="sentMcap">â€“</span><span class="ind-signal sig-neutral" id="sentMcapSig">LÃ„DT</span></div>
    <div class="indicator-row"><span class="ind-name">VolatilitÃ¤t (7T)</span><span class="ind-val" id="sentVol">â€“</span><span class="ind-signal sig-neutral" id="sentVolSig">LÃ„DT</span></div>
  </div>
</div>

<div class="card">
  <div class="card-header"><span class="card-title">Daytrader Playbook</span><span class="card-badge badge-day">HEUTE</span></div>
  <div id="playbookContent">
    <div class="tip-row"><span class="tip-icon">â³</span><span class="tip-text">Playbook wird geladen...</span></div>
  </div>
</div>
```

  </div>

  <!-- ORDERBOOK + BINANCE LIVE WIDGET -->

  <div class="ob-grid">

```
<!-- Orderbook Tiefe -->
<div class="card">
  <div class="card-header">
    <span class="card-title">Orderbook Tiefe Â· <span id="obCoinLabel">â€“</span></span>
    <span class="card-badge badge-live">BINANCE LIVE</span>
  </div>
  <div class="ob-pressure-bar-wrap">
    <span class="ob-label-buy">BID</span>
    <div class="ob-pressure-bar">
      <div class="ob-bid-fill" id="obBidFill" style="width:50%"></div>
    </div>
    <span class="ob-label-ask">ASK</span>
  </div>
  <div class="ob-pct-row">
    <span id="obBidPct" style="color:var(--green);font-family:'Orbitron',monospace;font-size:18px;font-weight:700">â€“</span>
    <span style="color:var(--text-dim);font-size:12px">KaufÂ­druck vs. VerkaufsÂ­druck</span>
    <span id="obAskPct" style="color:var(--red);font-family:'Orbitron',monospace;font-size:18px;font-weight:700">â€“</span>
  </div>
  <div class="ob-rows" id="obRows">
    <div class="ob-row ob-header">
      <span>Bid (Kauf)</span><span>Preis</span><span>Ask (Verkauf)</span>
    </div>
    <div style="text-align:center;color:var(--text-dim);padding:16px;font-size:12px">Wird geladen...</div>
  </div>
  <div style="margin-top:12px;font-size:11px;color:var(--text-dim);font-family:'Share Tech Mono',monospace" id="obSpread">Spread: â€“</div>
</div>

<!-- Binance Live Stats -->
<div class="card">
  <div class="card-header">
    <span class="card-title">Markt-Statistiken Â· Live</span>
    <span class="card-badge badge-live">BINANCE</span>
  </div>
  <div id="binanceStats">
    <div class="indicator-row"><span class="ind-name">Akt. Kurs (Binance)</span><span class="ind-val" id="bsPrice">â€“</span><span class="ind-signal sig-neutral" id="bsPriceSig">LÃ„DT</span></div>
    <div class="indicator-row"><span class="ind-name">Bid / Ask</span><span class="ind-val" id="bsBidAsk">â€“</span><span class="ind-signal sig-neutral" id="bsSpreadSig">â€“</span></div>
    <div class="indicator-row"><span class="ind-name">Volumen-Ratio (20x)</span><span class="ind-val" id="bsVolRatio">â€“</span><span class="ind-signal sig-neutral" id="bsVolSig">LÃ„DT</span></div>
    <div class="indicator-row"><span class="ind-name">ATR (14h) Stop-Dist.</span><span class="ind-val" id="bsAtr">â€“</span><span class="ind-signal sig-neutral" id="bsAtrSig">â€“</span></div>
    <div class="indicator-row"><span class="ind-name">Trades 24H</span><span class="ind-val" id="bsTrades">â€“</span><span class="ind-signal sig-neutral" id="bsTradesSig">â€“</span></div>
    <div class="indicator-row"><span class="ind-name">Orderbook-Druck</span><span class="ind-val" id="bsObPressure">â€“</span><span class="ind-signal sig-neutral" id="bsObSig">LÃ„DT</span></div>
  </div>
</div>
```

  </div>

  <footer>
    <div class="disclaimer">âš ï¸ KEIN FINANZRAT Â· NUR INFORMATIONSZWECKE Â· KRYPTOMÃ„RKTE SIND HOCHVOLATIL Â· INVESTIERE NUR WAS DU VERLIEREN KANNST</div>
    <div class="footer-brand" id="footerBrand">CRYPTO SIGNAL DASHBOARD</div>
  </footer>
</div>

</div><!-- end pageDashboard -->

<!-- ====== PAGE: PORTFOLIO ADVISOR ====== -->

<div class="page" id="pagePortfolio">
<div class="container">

  <div style="padding:24px 0 16px;">
    <h2 style="font-family:'Orbitron',monospace;font-size:18px;color:#fff;letter-spacing:3px;">â—ˆ PORTFOLIO ADVISOR</h2>
    <p style="font-family:'Share Tech Mono',monospace;font-size:12px;color:var(--accent);margin-top:6px;letter-spacing:1px;">KI-ANALYSE Â· TAUSCH-EMPFEHLUNGEN Â· RENDITE-OPTIMIERUNG</p>
  </div>

  <!-- INPUT + RESULTS GRID -->

  <div class="portfolio-grid">

```
<!-- LINKE SPALTE: Eingabe -->
<div>
  <div class="portfolio-input-card">
    <h3>â—ˆ MEINE COINS</h3>
    <div style="font-family:'Share Tech Mono',monospace;font-size:11px;color:var(--text-dim);margin-bottom:14px;">Coin auswÃ¤hlen Â· Betrag in USD eingeben</div>

    <div id="coinInputList">
      <!-- Zeilen werden per JS eingefÃ¼gt -->
    </div>

    <button class="add-coin-btn" onclick="addCoinRow()">+ COIN HINZUFÃœGEN</button>

    <div style="margin-top:20px;">
      <div style="font-family:'Share Tech Mono',monospace;font-size:11px;color:var(--text-dim);margin-bottom:10px;">ANLAGEHORIZONT:</div>
      <div class="horizon-btns">
        <button class="horizon-btn active" data-days="3" onclick="setHorizon(3)">3 TAGE</button>
        <button class="horizon-btn" data-days="7" onclick="setHorizon(7)">7 TAGE</button>
        <button class="horizon-btn" data-days="30" onclick="setHorizon(30)">30 TAGE</button>
      </div>
    </div>

    <button class="analyze-portfolio-btn" id="portfolioAnalyzeBtn" onclick="analyzePortfolio()">
      âš¡ ANALYSE STARTEN
    </button>

    <div style="margin-top:14px;font-size:11px;color:var(--text-dim);font-family:'Share Tech Mono',monospace;line-height:1.6;border-top:1px solid var(--border);padding-top:14px;">
      âš ï¸ Alle Empfehlungen basieren auf technischen Indikatoren und KI-Analyse. Kein Finanzrat. Eigene Recherche erforderlich.
    </div>
  </div>
</div>

<!-- RECHTE SPALTE: Ergebnisse -->
<div id="portfolioResults">
  <div class="portfolio-empty">
    <div class="empty-icon">â—ˆ</div>
    <div>Coins eingeben und Analyse starten</div>
    <div style="margin-top:8px;font-size:11px;opacity:0.5;">KI analysiert Marktdaten und gibt Tausch-Empfehlungen</div>
  </div>
</div>
```

  </div>

</div>
</div><!-- end pagePortfolio -->

<script>
const COIN_DATA = {
  BTC:  { name:'Bitcoin',       price:'$97,420',    change:'-0.8',  h24:'$99,100',   l24:'$95,800',   p7d:'-3.2',  p30d:'-18.5', rsi:'52.3', macd:'+120',  williams:'-45.2', ma5:'$99,800',  ma50:'$94,200', bb:'0.0821', vol:'$38.2 Mrd', macdSig:'neutral', rsiSig:'neutral', willSig:'neutral', ma5sig:'sell', ma50sig:'buy', bbSig:'neutral', volSig:'normal', signal:'neutral', conf:'60', risk:2, fear:32, sup1:'$90,000', sup2:'$82,000', res1:'$100,000', res2:'$108,000', cur:'$97,420', scN:50,scB:35,scBr:15, entryLong:'$100,000â€“$101,000', stop:'$94,500', tp1:'$104,000', tp2:'$108,000â€“$112,000', btcNote:'BTC ist der Markt â€“ folge dem Trend. Ãœber $100K bullisch.' },
  ETH:  { name:'Ethereum',      price:'$2,680',     change:'+1.2',  h24:'$2,720',    l24:'$2,590',    p7d:'+2.1',  p30d:'-22.1', rsi:'41.5', macd:'-18.4', williams:'-72.1', ma5:'$2,820',   ma50:'$2,540', bb:'0.1245', vol:'$14.1 Mrd', macdSig:'sell', rsiSig:'neutral', willSig:'neutral', ma5sig:'sell', ma50sig:'buy', bbSig:'neutral', volSig:'normal', signal:'neutral', conf:'58', risk:3, fear:32, sup1:'$2,500', sup2:'$2,200', res1:'$2,800', res2:'$3,200', cur:'$2,680', scN:45,scB:30,scBr:25, entryLong:'$2,800â€“$2,850', stop:'$2,530', tp1:'$2,980', tp2:'$3,150â€“$3,300', btcNote:'ETH folgt BTC stark. ETH/BTC Ratio beobachten.' },
  XRP:  { name:'XRP / Ripple',  price:'$1.46',      change:'+4.4',  h24:'$1.51',     l24:'$1.38',     p7d:'+0.02', p30d:'-31.3', rsi:'34.8', macd:'-0.155',williams:'-89.1', ma5:'$1.73',    ma50:'$1.95', bb:'0.1745', vol:'$2.48 Mrd', macdSig:'sell', rsiSig:'neutral', willSig:'buy', ma5sig:'sell', ma50sig:'sell', bbSig:'neutral', volSig:'normal', signal:'neutral', conf:'65', risk:3, fear:32, sup1:'$1.35', sup2:'$1.15', res1:'$1.50', res2:'$1.77', cur:'$1.46', scN:45,scB:35,scBr:20, entryLong:'$1.50â€“$1.52', stop:'$1.38', tp1:'$1.55', tp2:'$1.65â€“$1.70', btcNote:'XRP korreliert stark mit BTC. BTC Ã¼ber $100K = sehr positiv.' },
  BNB:  { name:'BNB',           price:'$618',       change:'-0.3',  h24:'$628',      l24:'$610',      p7d:'-1.4',  p30d:'-12.0', rsi:'48.2', macd:'+2.1',  williams:'-51.3', ma5:'$625',     ma50:'$598', bb:'0.0612', vol:'$1.82 Mrd', macdSig:'buy', rsiSig:'neutral', willSig:'neutral', ma5sig:'sell', ma50sig:'buy', bbSig:'neutral', volSig:'normal', signal:'neutral', conf:'55', risk:2, fear:35, sup1:'$595', sup2:'$560', res1:'$640', res2:'$680', cur:'$618', scN:50,scB:30,scBr:20, entryLong:'$640â€“$645', stop:'$608', tp1:'$658', tp2:'$675â€“$685', btcNote:'BNB relativ stabil. Binance-News im Auge behalten.' },
  SOL:  { name:'Solana',        price:'$172',       change:'+2.1',  h24:'$178',      l24:'$166',      p7d:'+5.3',  p30d:'-28.4', rsi:'38.6', macd:'-3.2',  williams:'-78.4', ma5:'$181',     ma50:'$168', bb:'0.1523', vol:'$4.62 Mrd', macdSig:'sell', rsiSig:'neutral', willSig:'buy', ma5sig:'sell', ma50sig:'buy', bbSig:'neutral', volSig:'hoch', signal:'buy', conf:'62', risk:4, fear:30, sup1:'$155', sup2:'$140', res1:'$185', res2:'$210', cur:'$172', scN:35,scB:45,scBr:20, entryLong:'$172â€“$175', stop:'$162', tp1:'$188', tp2:'$200â€“$210', btcNote:'SOL zeigt relative StÃ¤rke. Ecosystem-News positiv.' },
  ADA:  { name:'Cardano',       price:'$0.784',     change:'+3.1',  h24:'$0.810',    l24:'$0.752',    p7d:'+1.8',  p30d:'-35.2', rsi:'31.4', macd:'-0.012',williams:'-84.2', ma5:'$0.851',   ma50:'$0.920', bb:'0.1892', vol:'$0.98 Mrd', macdSig:'sell', rsiSig:'buy', willSig:'buy', ma5sig:'sell', ma50sig:'sell', bbSig:'neutral', volSig:'normal', signal:'buy', conf:'60', risk:4, fear:28, sup1:'$0.720', sup2:'$0.660', res1:'$0.850', res2:'$0.950', cur:'$0.784', scN:35,scB:40,scBr:25, entryLong:'$0.784â€“$0.800', stop:'$0.745', tp1:'$0.855', tp2:'$0.920â€“$0.950', btcNote:'ADA stark Ã¼berverkauft â€“ Bounce mÃ¶glich, aber kein Trend.' },
  AVAX: { name:'Avalanche',     price:'$24.80',     change:'-1.2',  h24:'$25.90',    l24:'$24.10',    p7d:'-4.3',  p30d:'-41.0', rsi:'28.9', macd:'-0.88', williams:'-91.2', ma5:'$27.40',   ma50:'$29.10', bb:'0.2134', vol:'$0.74 Mrd', macdSig:'sell', rsiSig:'buy', willSig:'buy', ma5sig:'sell', ma50sig:'sell', bbSig:'neutral', volSig:'normal', signal:'buy', conf:'58', risk:4, fear:26, sup1:'$22.50', sup2:'$19.00', res1:'$28.00', res2:'$34.00', cur:'$24.80', scN:30,scB:42,scBr:28, entryLong:'$24.80â€“$25.50', stop:'$22.80', tp1:'$28.50', tp2:'$32.00â€“$34.00', btcNote:'AVAX extrem Ã¼berverkauft. Hohes Risiko, aber gutes R/R.' },
  DOGE: { name:'Dogecoin',      price:'$0.241',     change:'-1.4',  h24:'$0.252',    l24:'$0.235',    p7d:'-5.1',  p30d:'-44.0', rsi:'29.3', macd:'-0.004',williams:'-88.5', ma5:'$0.268',   ma50:'$0.312', bb:'0.1978', vol:'$1.24 Mrd', macdSig:'sell', rsiSig:'buy', willSig:'buy', ma5sig:'sell', ma50sig:'sell', bbSig:'neutral', volSig:'normal', signal:'neutral', conf:'50', risk:5, fear:25, sup1:'$0.220', sup2:'$0.190', res1:'$0.260', res2:'$0.310', cur:'$0.241', scN:40,scB:30,scBr:30, entryLong:'$0.260â€“$0.265', stop:'$0.228', tp1:'$0.278', tp2:'$0.295â€“$0.310', btcNote:'DOGE abhÃ¤ngig von Social Media Hype. Vorsicht!' },
  DOT:  { name:'Polkadot',      price:'$4.82',      change:'+0.6',  h24:'$4.95',     l24:'$4.71',     p7d:'-2.8',  p30d:'-38.0', rsi:'33.1', macd:'-0.14', williams:'-82.3', ma5:'$5.12',    ma50:'$5.88', bb:'0.1654', vol:'$0.41 Mrd', macdSig:'sell', rsiSig:'neutral', willSig:'buy', ma5sig:'sell', ma50sig:'sell', bbSig:'neutral', volSig:'niedrig', signal:'neutral', conf:'52', risk:4, fear:30, sup1:'$4.40', sup2:'$3.90', res1:'$5.20', res2:'$6.00', cur:'$4.82', scN:45,scB:30,scBr:25, entryLong:'$5.20â€“$5.30', stop:'$4.55', tp1:'$5.65', tp2:'$5.90â€“$6.00', btcNote:'DOT schwach â€“ warte auf Ausbruch Ã¼ber $5.20 vor Kauf.' },
  LINK: { name:'Chainlink',     price:'$13.40',     change:'+1.8',  h24:'$13.80',    l24:'$13.00',    p7d:'-1.2',  p30d:'-29.0', rsi:'37.5', macd:'-0.42', williams:'-76.8', ma5:'$14.20',   ma50:'$15.80', bb:'0.1432', vol:'$0.62 Mrd', macdSig:'sell', rsiSig:'neutral', willSig:'buy', ma5sig:'sell', ma50sig:'sell', bbSig:'neutral', volSig:'normal', signal:'neutral', conf:'57', risk:3, fear:31, sup1:'$12.50', sup2:'$11.00', res1:'$14.50', res2:'$17.00', cur:'$13.40', scN:45,scB:35,scBr:20, entryLong:'$14.50â€“$14.80', stop:'$12.80', tp1:'$15.80', tp2:'$16.80â€“$17.00', btcNote:'LINK zeigt ErholungsansÃ¤tze. DeFi-Narrative positiv.' },
  MATIC:{ name:'Polygon',       price:'$0.198',     change:'+2.3',  h24:'$0.205',    l24:'$0.191',    p7d:'-3.5',  p30d:'-46.0', rsi:'27.8', macd:'-0.006',williams:'-92.4', ma5:'$0.218',   ma50:'$0.265', bb:'0.2241', vol:'$0.38 Mrd', macdSig:'sell', rsiSig:'buy', willSig:'buy', ma5sig:'sell', ma50sig:'sell', bbSig:'neutral', volSig:'normal', signal:'buy', conf:'55', risk:5, fear:24, sup1:'$0.180', sup2:'$0.155', res1:'$0.225', res2:'$0.270', cur:'$0.198', scN:30,scB:40,scBr:30, entryLong:'$0.198â€“$0.205', stop:'$0.185', tp1:'$0.228', tp2:'$0.255â€“$0.270', btcNote:'MATIC/POL sehr stark Ã¼berverkauft. Rebound mÃ¶glich.' },
  UNI:  { name:'Uniswap',       price:'$7.45',      change:'+0.9',  h24:'$7.68',     l24:'$7.22',     p7d:'-4.0',  p30d:'-33.0', rsi:'34.2', macd:'-0.22', williams:'-81.5', ma5:'$7.95',    ma50:'$8.80', bb:'0.1543', vol:'$0.28 Mrd', macdSig:'sell', rsiSig:'neutral', willSig:'buy', ma5sig:'sell', ma50sig:'sell', bbSig:'neutral', volSig:'niedrig', signal:'neutral', conf:'53', risk:4, fear:29, sup1:'$6.80', sup2:'$5.90', res1:'$8.20', res2:'$9.50', cur:'$7.45', scN:42,scB:33,scBr:25, entryLong:'$8.20â€“$8.40', stop:'$7.10', tp1:'$8.80', tp2:'$9.20â€“$9.50', btcNote:'UNI kÃ¤mpft mit DeFi-Konkurrenz. Volumen niedrig.' },
  ATOM: { name:'Cosmos',        price:'$4.12',      change:'-0.5',  h24:'$4.28',     l24:'$4.02',     p7d:'-6.2',  p30d:'-39.0', rsi:'30.7', macd:'-0.18', williams:'-86.3', ma5:'$4.48',    ma50:'$4.92', bb:'0.1721', vol:'$0.19 Mrd', macdSig:'sell', rsiSig:'neutral', willSig:'buy', ma5sig:'sell', ma50sig:'sell', bbSig:'neutral', volSig:'niedrig', signal:'neutral', conf:'50', risk:4, fear:28, sup1:'$3.80', sup2:'$3.40', res1:'$4.50', res2:'$5.20', cur:'$4.12', scN:43,scB:32,scBr:25, entryLong:'$4.50â€“$4.60', stop:'$3.90', tp1:'$4.90', tp2:'$5.10â€“$5.20', btcNote:'ATOM schwach. IBC-Ecosystem-News wichtig.' },
  LTC:  { name:'Litecoin',      price:'$86.20',     change:'+1.1',  h24:'$88.50',    l24:'$84.10',    p7d:'-2.0',  p30d:'-25.0', rsi:'40.1', macd:'-1.24', williams:'-68.4', ma5:'$89.40',   ma50:'$91.20', bb:'0.1124', vol:'$0.55 Mrd', macdSig:'sell', rsiSig:'neutral', willSig:'neutral', ma5sig:'sell', ma50sig:'sell', bbSig:'neutral', volSig:'normal', signal:'neutral', conf:'55', risk:3, fear:32, sup1:'$80.00', sup2:'$72.00', res1:'$92.00', res2:'$102.00', cur:'$86.20', scN:48,scB:32,scBr:20, entryLong:'$92.00â€“$93.50', stop:'$82.50', tp1:'$98.00', tp2:'$100.00â€“$102.00', btcNote:'LTC folgt BTC mit VerzÃ¶gerung. Halving-Effekte beachten.' },
  NEAR: { name:'NEAR Protocol', price:'$2.84',      change:'+2.8',  h24:'$2.95',     l24:'$2.72',     p7d:'-5.5',  p30d:'-42.0', rsi:'29.5', macd:'-0.09', williams:'-88.7', ma5:'$3.12',    ma50:'$3.58', bb:'0.1988', vol:'$0.32 Mrd', macdSig:'sell', rsiSig:'buy', willSig:'buy', ma5sig:'sell', ma50sig:'sell', bbSig:'neutral', volSig:'normal', signal:'buy', conf:'56', risk:5, fear:26, sup1:'$2.55', sup2:'$2.20', res1:'$3.20', res2:'$3.80', cur:'$2.84', scN:33,scB:40,scBr:27, entryLong:'$2.84â€“$2.95', stop:'$2.62', tp1:'$3.25', tp2:'$3.55â€“$3.80', btcNote:'NEAR AI-Narrative positiv. Starkes Ecosystem.' },
  ARB:  { name:'Arbitrum',      price:'$0.362',     change:'+1.5',  h24:'$0.375',    l24:'$0.350',    p7d:'-7.1',  p30d:'-48.0', rsi:'26.4', macd:'-0.014',williams:'-93.8', ma5:'$0.398',   ma50:'$0.445', bb:'0.2312', vol:'$0.44 Mrd', macdSig:'sell', rsiSig:'buy', willSig:'buy', ma5sig:'sell', ma50sig:'sell', bbSig:'neutral', volSig:'hoch', signal:'buy', conf:'54', risk:5, fear:24, sup1:'$0.330', sup2:'$0.290', res1:'$0.400', res2:'$0.460', cur:'$0.362', scN:30,scB:42,scBr:28, entryLong:'$0.362â€“$0.375', stop:'$0.338', tp1:'$0.405', tp2:'$0.440â€“$0.460', btcNote:'ARB L2-MarktfÃ¼hrer. Extrem Ã¼berverkauft â€“ Risiko hoch.' },
  OP:   { name:'Optimism',      price:'$0.724',     change:'+3.2',  h24:'$0.748',    l24:'$0.695',    p7d:'-6.8',  p30d:'-50.0', rsi:'25.9', macd:'-0.028',williams:'-94.2', ma5:'$0.798',   ma50:'$0.880', bb:'0.2456', vol:'$0.28 Mrd', macdSig:'sell', rsiSig:'buy', willSig:'buy', ma5sig:'sell', ma50sig:'sell', bbSig:'neutral', volSig:'normal', signal:'buy', conf:'53', risk:5, fear:23, sup1:'$0.660', sup2:'$0.580', res1:'$0.810', res2:'$0.940', cur:'$0.724', scN:28,scB:44,scBr:28, entryLong:'$0.724â€“$0.745', stop:'$0.672', tp1:'$0.820', tp2:'$0.880â€“$0.940', btcNote:'OP auf historischen Tiefs. Nur fÃ¼r risikobereite Trader.' },
  SUI:  { name:'Sui',           price:'$2.14',      change:'+4.5',  h24:'$2.22',     l24:'$2.03',     p7d:'+1.2',  p30d:'-36.0', rsi:'36.8', macd:'-0.062',williams:'-77.3', ma5:'$2.28',    ma50:'$2.48', bb:'0.1834', vol:'$0.88 Mrd', macdSig:'sell', rsiSig:'neutral', willSig:'buy', ma5sig:'sell', ma50sig:'sell', bbSig:'neutral', volSig:'hoch', signal:'neutral', conf:'58', risk:4, fear:30, sup1:'$1.90', sup2:'$1.65', res1:'$2.40', res2:'$2.80', cur:'$2.14', scN:38,scB:40,scBr:22, entryLong:'$2.14â€“$2.22', stop:'$1.96', tp1:'$2.45', tp2:'$2.65â€“$2.80', btcNote:'SUI zeigt relative StÃ¤rke. Gaming/DeFi Ecosystem wÃ¤chst.' },
  SHIB: { name:'Shiba Inu',     price:'$0.0000122', change:'-2.1',  h24:'$0.0000130',l24:'$0.0000118',p7d:'-8.3',  p30d:'-52.0', rsi:'24.1', macd:'-0.000001',williams:'-95.1',ma5:'$0.0000138',ma50:'$0.0000165',bb:'0.2541',vol:'$0.62 Mrd',macdSig:'sell',rsiSig:'buy',willSig:'buy',ma5sig:'sell',ma50sig:'sell',bbSig:'neutral',volSig:'normal', signal:'neutral', conf:'40', risk:5, fear:22, sup1:'$0.0000110', sup2:'$0.0000095', res1:'$0.0000140', res2:'$0.0000175', cur:'$0.0000122', scN:35,scB:28,scBr:37, entryLong:'$0.0000140â€“$0.0000145', stop:'$0.0000112', tp1:'$0.0000158', tp2:'$0.0000170â€“$0.0000175', btcNote:'SHIB reiner Meme-Coin. Ohne BTC-Rallye kein Upside.' },
  PEPE: { name:'Pepe Coin',     price:'$0.00000812',change:'-3.4',  h24:'$0.00000870',l24:'$0.00000785',p7d:'-11.2',p30d:'-58.0',rsi:'21.7', macd:'-0.0000004',williams:'-96.8',ma5:'$0.00000945',ma50:'$0.0000118',bb:'0.2812',vol:'$0.94 Mrd',macdSig:'sell',rsiSig:'buy',willSig:'buy',ma5sig:'sell',ma50sig:'sell',bbSig:'neutral',volSig:'hoch', signal:'sell', conf:'45', risk:5, fear:20, sup1:'$0.0000075', sup2:'$0.0000060', res1:'$0.0000095', res2:'$0.0000120', cur:'$0.00000812', scN:28,scB:22,scBr:50, entryLong:'Kein Long empfohlen', stop:'$0.0000076', tp1:'$0.0000095', tp2:'$0.0000110â€“$0.0000120', btcNote:'PEPE extrem riskant. Nur mit kleiner Position und engem Stop.' },
  FLOKI:{ name:'Floki Inu',     price:'$0.0000648', change:'-1.8',  h24:'$0.0000672',l24:'$0.0000631',p7d:'-9.0',  p30d:'-55.0', rsi:'23.3', macd:'-0.000003',williams:'-93.5',ma5:'$0.0000724',ma50:'$0.0000885',bb:'0.2634',vol:'$0.14 Mrd',macdSig:'sell',rsiSig:'buy',willSig:'buy',ma5sig:'sell',ma50sig:'sell',bbSig:'neutral',volSig:'niedrig', signal:'neutral', conf:'38', risk:5, fear:21, sup1:'$0.0000600', sup2:'$0.0000520', res1:'$0.0000720', res2:'$0.0000880', cur:'$0.0000648', scN:32,scB:24,scBr:44, entryLong:'$0.0000648â€“$0.0000670', stop:'$0.0000608', tp1:'$0.0000725', tp2:'$0.0000840â€“$0.0000880', btcNote:'FLOKI Meme-Coin. Extrem volatil und manipulierbar.' },
};

const SIGNAL_LABELS = {
  buy:     { text:'KAUFEN',  sub:'Bullisches Setup erkannt',  cls:'buy' },
  sell:    { text:'VERKAUFEN',sub:'BÃ¤risches Signal aktiv', cls:'sell' },
  neutral: { text:'HALTEN',  sub:'Abwarten empfohlen',        cls:'neutral' },
};

let currentCoin = 'XRP';

// CoinGecko IDs fÃ¼r alle Coins
const COINGECKO_IDS = {
  BTC:'bitcoin', ETH:'ethereum', XRP:'ripple', BNB:'binancecoin',
  SOL:'solana', ADA:'cardano', AVAX:'avalanche-2', DOGE:'dogecoin',
  DOT:'polkadot', LINK:'chainlink', MATIC:'matic-network', UNI:'uniswap',
  ATOM:'cosmos', LTC:'litecoin', NEAR:'near', ARB:'arbitrum',
  OP:'optimism', SUI:'sui', SHIB:'shiba-inu', PEPE:'pepe', FLOKI:'floki',
};

// Live-Preis + 7d/30d Performance + Marktdaten von CoinGecko
async function fetchLivePrice(sym) {
  const id = COINGECKO_IDS[sym];
  if (!id) return null;
  try {
    const url = `https://api.coingecko.com/api/v3/coins/${id}?localization=false&tickers=false&community_data=false&developer_data=false&sparkline=true`;
    const res = await fetch(url);
    if (!res.ok) return null;
    const json = await res.json();
    const m = json.market_data;
    return {
      price:       m.current_price.usd,
      change24h:   m.price_change_percentage_24h,
      change7d:    m.price_change_percentage_7d,
      change30d:   m.price_change_percentage_30d,
      high24h:     m.high_24h.usd,
      low24h:      m.low_24h.usd,
      vol24h:      m.total_volume.usd,
      marketCap:   m.market_cap.usd,
      sparkline:   json.market_data.sparkline_7d?.price || [],  // 7-Tage Stundenwerte
    };
  } catch(e) { return null; }
}

// RSI aus Preisreihe berechnen (14 Perioden)
function calcRSI(prices, period = 14) {
  if (prices.length < period + 1) return null;
  let gains = 0, losses = 0;
  for (let i = 1; i <= period; i++) {
    const diff = prices[i] - prices[i - 1];
    if (diff >= 0) gains += diff; else losses -= diff;
  }
  let avgGain = gains / period;
  let avgLoss = losses / period;
  for (let i = period + 1; i < prices.length; i++) {
    const diff = prices[i] - prices[i - 1];
    avgGain = (avgGain * (period - 1) + Math.max(diff, 0)) / period;
    avgLoss = (avgLoss * (period - 1) + Math.max(-diff, 0)) / period;
  }
  if (avgLoss === 0) return 100;
  const rs = avgGain / avgLoss;
  return parseFloat((100 - 100 / (1 + rs)).toFixed(2));
}

// Simple Moving Average
function calcSMA(prices, period) {
  if (prices.length < period) return null;
  const slice = prices.slice(-period);
  return slice.reduce((a, b) => a + b, 0) / period;
}

// MACD (12,26 EMA Differenz)
function calcEMA(prices, period) {
  if (prices.length < period) return null;
  const k = 2 / (period + 1);
  let ema = prices.slice(0, period).reduce((a, b) => a + b, 0) / period;
  for (let i = period; i < prices.length; i++) {
    ema = prices[i] * k + ema * (1 - k);
  }
  return ema;
}

function calcMACD(prices) {
  const ema12 = calcEMA(prices, 12);
  const ema26 = calcEMA(prices, 26);
  if (!ema12 || !ema26) return null;
  return parseFloat((ema12 - ema26).toFixed(6));
}

// Bollinger Band Breite
function calcBB(prices, period = 20) {
  if (prices.length < period) return null;
  const slice = prices.slice(-period);
  const mean = slice.reduce((a, b) => a + b, 0) / period;
  const variance = slice.reduce((s, v) => s + Math.pow(v - mean, 2), 0) / period;
  const std = Math.sqrt(variance);
  return parseFloat(((2 * std) / mean).toFixed(4));
}

// Williams %R
function calcWilliams(prices, period = 14) {
  if (prices.length < period) return null;
  const slice = prices.slice(-period);
  const highest = Math.max(...slice);
  const lowest  = Math.min(...slice);
  const current = prices[prices.length - 1];
  if (highest === lowest) return -50;
  return parseFloat((((highest - current) / (highest - lowest)) * -100).toFixed(2));
}

// Fear & Greed Index von Alternative.me
async function fetchFearGreed() {
  try {
    const res = await fetch('https://api.alternative.me/fng/?limit=1');
    if (!res.ok) return null;
    const json = await res.json();
    return {
      value: parseInt(json.data[0].value),
      label: json.data[0].value_classification,
    };
  } catch(e) { return null; }
}

// Ticker fÃ¼r ALLE sichtbaren Coins auf einmal von CoinGecko laden
async function fetchAllTickerPrices() {
  try {
    const ids = Object.values(COINGECKO_IDS).join(',');
    const url = `https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd&include_24hr_change=true&include_market_cap=true`;
    const res = await fetch(url);
    if (!res.ok) return null;
    return await res.json();
  } catch(e) { return null; }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BINANCE API  (kostenlos, kein Key nÃ¶tig)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const BINANCE_SYMBOLS = {
  BTC:'BTCUSDT', ETH:'ETHUSDT', XRP:'XRPUSDT', BNB:'BNBUSDT',
  SOL:'SOLUSDT', ADA:'ADAUSDT', AVAX:'AVAXUSDT', DOGE:'DOGEUSDT',
  DOT:'DOTUSDT', LINK:'LINKUSDT', MATIC:'MATICUSDT', UNI:'UNIUSDT',
  ATOM:'ATOMUSDT', LTC:'LTCUSDT', NEAR:'NEARUSDT', ARB:'ARBUSDT',
  OP:'OPUSDT', SUI:'SUIUSDT', SHIB:'SHIBUSDT', PEPE:'PEPEUSDT', FLOKI:'FLOKIUSDT',
};

const BINANCE_BASE = 'https://api.binance.com/api/v3';

// 24h-Ticker von Binance (prÃ¤ziser als CoinGecko fÃ¼r intraday)
async function fetchBinanceTicker(sym) {
  const pair = BINANCE_SYMBOLS[sym];
  if (!pair) return null;
  try {
    const res = await fetch(`${BINANCE_BASE}/ticker/24hr?symbol=${pair}`);
    if (!res.ok) return null;
    const t = await res.json();
    return {
      price:     parseFloat(t.lastPrice),
      change24h: parseFloat(t.priceChangePercent),
      high24h:   parseFloat(t.highPrice),
      low24h:    parseFloat(t.lowPrice),
      vol24h:    parseFloat(t.quoteVolume),   // in USD
      openPrice: parseFloat(t.openPrice),
      trades:    parseInt(t.count),
    };
  } catch(e) { return null; }
}

// Kerzen (OHLCV) von Binance holen â€“ Basis fÃ¼r echte Indikator-Berechnung
// interval: '1h' | '4h' | '1d'   limit: max 1000
async function fetchBinanceKlines(sym, interval = '1h', limit = 500) {
  const pair = BINANCE_SYMBOLS[sym];
  if (!pair) return null;
  try {
    const url = `${BINANCE_BASE}/klines?symbol=${pair}&interval=${interval}&limit=${limit}`;
    const res = await fetch(url);
    if (!res.ok) return null;
    const raw = await res.json();
    // Binance gibt zurÃ¼ck: [openTime, open, high, low, close, volume, ...]
    return raw.map(k => ({
      t:  k[0],                      // timestamp ms
      o:  parseFloat(k[1]),          // open
      h:  parseFloat(k[2]),          // high
      l:  parseFloat(k[3]),          // low
      c:  parseFloat(k[4]),          // close
      v:  parseFloat(k[5]),          // volume (base)
      qv: parseFloat(k[7]),          // quote volume (USD)
    }));
  } catch(e) { return null; }
}

// Orderbook-Tiefe von Binance (Top 5 Bids/Asks)
async function fetchBinanceOrderbook(sym) {
  const pair = BINANCE_SYMBOLS[sym];
  if (!pair) return null;
  try {
    const res = await fetch(`${BINANCE_BASE}/depth?symbol=${pair}&limit=5`);
    if (!res.ok) return null;
    const ob = await res.json();
    const bidVol = ob.bids.reduce((s, b) => s + parseFloat(b[0]) * parseFloat(b[1]), 0);
    const askVol = ob.asks.reduce((s, a) => s + parseFloat(a[0]) * parseFloat(a[1]), 0);
    const total  = bidVol + askVol;
    return {
      bidPct:   total > 0 ? (bidVol / total * 100).toFixed(1) : '50.0',
      askPct:   total > 0 ? (askVol / total * 100).toFixed(1) : '50.0',
      pressure: bidVol > askVol * 1.1 ? 'buy' : askVol > bidVol * 1.1 ? 'sell' : 'neutral',
      bestBid:  ob.bids[0] ? parseFloat(ob.bids[0][0]) : null,
      bestAsk:  ob.asks[0] ? parseFloat(ob.asks[0][0]) : null,
    };
  } catch(e) { return null; }
}

// Gleitender Durchschnitt Volumen (zeigt ob aktuelles Vol Ã¼ber/unter Schnitt)
function calcVolRatio(klines, period = 20) {
  if (!klines || klines.length < period + 1) return null;
  const avgVol = klines.slice(-period - 1, -1).reduce((s, k) => s + k.qv, 0) / period;
  const curVol = klines[klines.length - 1].qv;
  return curVol / avgVol; // >1.5 = hohes Volumen, <0.5 = niedrig
}

// ATR (Average True Range) fÃ¼r Stop-Loss-Berechnung
function calcATR(klines, period = 14) {
  if (!klines || klines.length < period + 1) return null;
  const trs = [];
  for (let i = 1; i < klines.length; i++) {
    const h = klines[i].h, l = klines[i].l, pc = klines[i-1].c;
    trs.push(Math.max(h - l, Math.abs(h - pc), Math.abs(l - pc)));
  }
  return trs.slice(-period).reduce((a, b) => a + b, 0) / period;
}

// Preis schÃ¶n formatieren
function fmtPrice(p) {
  if (!p && p !== 0) return 'â€“';
  if (p >= 10000)      return '$' + p.toLocaleString('de-DE', {maximumFractionDigits: 0});
  if (p >= 1000)       return '$' + p.toLocaleString('de-DE', {minimumFractionDigits: 2, maximumFractionDigits: 2});
  if (p >= 1)          return '$' + p.toFixed(4);
  if (p >= 0.01)       return '$' + p.toFixed(4);
  if (p >= 0.0001)     return '$' + p.toFixed(6);
  return '$' + p.toFixed(8);
}

function fmtVol(v) {
  if (!v) return 'â€“';
  if (v >= 1e9) return '$' + (v/1e9).toFixed(2) + ' Mrd';
  if (v >= 1e6) return '$' + (v/1e6).toFixed(1) + ' Mio';
  return '$' + v.toFixed(0);
}

function fmtMarketCap(v) {
  if (!v) return 'â€“';
  if (v >= 1e12) return '$' + (v/1e12).toFixed(2) + ' Bio';
  if (v >= 1e9)  return '$' + (v/1e9).toFixed(1) + ' Mrd';
  return '$' + (v/1e6).toFixed(0) + ' Mio';
}

function quickSelect(sym) {
  document.getElementById('coinSelect').value = sym;
  document.querySelectorAll('.chip').forEach(c => {
    c.classList.toggle('active', c.textContent === sym);
  });
  runAnalysis();
}

document.getElementById('coinSelect').addEventListener('change', function() {
  const sym = this.value;
  document.querySelectorAll('.chip').forEach(c => {
    c.classList.toggle('active', c.textContent === sym);
  });
});

async function runAnalysis() {
  const sym = document.getElementById('coinSelect').value;
  currentCoin = sym;
  const d = COIN_DATA[sym];
  if (!d) return;

  const btn = document.getElementById('analyzeBtn');
  const overlay = document.getElementById('loadingOverlay');
  const sub = document.getElementById('loadingSub');

  // Garantierter Escape nach 20 Sekunden â€“ niemals einfrieren
  const escapeTimer = setTimeout(() => {
    overlay.classList.remove('active');
    btn.disabled = false;
  }, 20000);

  btn.disabled = true;
  overlay.classList.add('active');
  sub.textContent = `Lade Live-Daten fÃ¼r ${d.name} (${sym})...`;

  try {
    // â”€â”€ Alle APIs parallel abrufen â”€â”€
    const [binanceTicker, binanceKlines, orderbook, cgData, fearGreed] = await Promise.all([
      fetchBinanceTicker(sym).catch(() => null),
      fetchBinanceKlines(sym, '1h', 500).catch(() => null),
      fetchBinanceOrderbook(sym).catch(() => null),
      fetchLivePrice(sym).catch(() => null),
      fetchFearGreed().catch(() => null),
    ]);

    // â”€â”€ 1. Kerndaten: Binance priorisieren â”€â”€
    const ticker = binanceTicker || (cgData ? {
      price: cgData.price, change24h: cgData.change24h,
      high24h: cgData.high24h, low24h: cgData.low24h, vol24h: cgData.vol24h,
    } : null);

    if (ticker) {
      const p = ticker.price;
      d.price   = fmtPrice(p);
      d.cur     = fmtPrice(p);
      d.change  = ticker.change24h != null ? ticker.change24h.toFixed(2) : d.change;
      d.h24     = fmtPrice(ticker.high24h);
      d.l24     = fmtPrice(ticker.low24h);
      d.vol     = fmtVol(ticker.vol24h);
      sub.textContent = `âœ“ Binance: ${d.price} (${d.change}%) | Indikatoren...`;
      if (binanceTicker?.trades) d._trades = binanceTicker.trades;
    }

    // â”€â”€ 2. CoinGecko: 7d/30d + Marktcap â”€â”€
    if (cgData) {
      d.p7d  = cgData.change7d  != null ? cgData.change7d.toFixed(2)  : d.p7d;
      d.p30d = cgData.change30d != null ? cgData.change30d.toFixed(2) : d.p30d;
      d._marketCap = cgData.marketCap;
    }

    // â”€â”€ 3. Technische Indikatoren aus Binance-Kerzen â”€â”€
    const closes = binanceKlines ? binanceKlines.map(k => k.c) : (cgData?.sparkline || []);
    const currentPrice = ticker?.price || parseFloat((d.price||'0').replace(/[$,]/g,'')) || 1;

    if (closes.length >= 26) {
      const rsi = calcRSI(closes, 14);
      if (rsi !== null) { d.rsi = rsi.toFixed(2); d.rsiSig = rsi < 30 ? 'buy' : rsi > 70 ? 'sell' : 'neutral'; }
      const macd = calcMACD(closes);
      if (macd !== null) { d.macd = macd.toFixed(6); d.macdSig = macd > 0 ? 'buy' : 'sell'; }
      const ma5  = calcSMA(closes, 5);
      const ma50 = calcSMA(closes, Math.min(50, closes.length));
      if (ma5)  { d.ma5  = fmtPrice(ma5);  d.ma5sig  = currentPrice > ma5  ? 'buy' : 'sell'; }
      if (ma50) { d.ma50 = fmtPrice(ma50); d.ma50sig = currentPrice > ma50 ? 'buy' : 'sell'; }
      const bb = calcBB(closes, 20);
      if (bb !== null) d.bb = bb.toFixed(4);
      const will = calcWilliams(closes, 14);
      if (will !== null) { d.williams = will.toFixed(2); d.willSig = will < -80 ? 'buy' : will > -20 ? 'sell' : 'neutral'; }
    }

    // â”€â”€ 4. Binance-Extras: ATR-Stop, echte S/R, Vol-Ratio â”€â”€
    if (binanceKlines && binanceKlines.length >= 26) {
      const p = currentPrice;
      const atr = calcATR(binanceKlines, 14);
      if (atr) {
        d.stop      = fmtPrice(p - atr * 1.5);
        d.tp1       = fmtPrice(p + atr * 2.0);
        d.tp2       = fmtPrice(p + atr * 3.5) + 'â€“' + fmtPrice(p + atr * 5.0);
        d.entryLong = fmtPrice(p) + 'â€“' + fmtPrice(p + atr * 0.5);
      }
      const volRatio = calcVolRatio(binanceKlines, 20);
      if (volRatio !== null) {
        d.volSig = volRatio > 1.8 ? 'hoch' : volRatio < 0.5 ? 'niedrig' : 'normal';
        d._volRatio = volRatio.toFixed(2);
      }
      const recent48 = binanceKlines.slice(-48);
      const week     = binanceKlines.slice(-168);
      d.sup1 = fmtPrice(Math.min(...recent48.map(k => k.l)));
      d.sup2 = fmtPrice(Math.min(...week.map(k => k.l)));
      d.res1 = fmtPrice(Math.max(...recent48.map(k => k.h)));
      d.res2 = fmtPrice(Math.max(...week.map(k => k.h)));
      sub.textContent = `âœ“ RSI: ${d.rsi} | MACD: ${parseFloat(d.macd) > 0 ? '+' : ''}${d.macd} | Vol: ${d.volSig}`;
    }

    // â”€â”€ 5. Orderbook â”€â”€
    if (orderbook) {
      d._orderbook = orderbook;
      if (orderbook.bestBid && orderbook.bestAsk) {
        d._spread = ((orderbook.bestAsk - orderbook.bestBid) / orderbook.bestBid * 100).toFixed(3) + '%';
      }
    }

    // â”€â”€ 6. Signal (kombiniert) â”€â”€
    const chgNum = parseFloat(d.change) || 0;
    const rsiNum = parseFloat(d.rsi) || 50;
    const obPressure = orderbook?.pressure || 'neutral';
    let bullScore = 0;
    if (rsiNum < 30) bullScore += 3; else if (rsiNum < 40) bullScore += 1;
    else if (rsiNum > 70) bullScore -= 3; else if (rsiNum > 60) bullScore -= 1;
    if (d.macdSig === 'buy') bullScore += 2; else if (d.macdSig === 'sell') bullScore -= 2;
    if (obPressure === 'buy') bullScore += 1; else if (obPressure === 'sell') bullScore -= 1;
    if (chgNum > 4) bullScore += 1; else if (chgNum < -4) bullScore -= 1;
    d.signal = bullScore >= 3 ? 'buy' : bullScore <= -3 ? 'sell' : 'neutral';

    // â”€â”€ 7. Fear & Greed â”€â”€
    if (fearGreed) {
      d.fear = fearGreed.value;
      const needle = document.getElementById('fearNeedle');
      const scoreEl = document.getElementById('fearScore');
      const labelEl = document.getElementById('fearLabel');
      if (needle) needle.style.left = fearGreed.value + '%';
      if (scoreEl) { scoreEl.textContent = fearGreed.value; scoreEl.style.color = fearGreed.value < 40 ? 'var(--red)' : fearGreed.value < 60 ? 'var(--yellow)' : 'var(--green)'; }
      if (labelEl) labelEl.textContent = fearGreed.label.toUpperCase();
      updateTickerMeta(fearGreed.value, fearGreed.label, null);
    }

    // â”€â”€ 8. UI + Orderbook Widget â”€â”€
    updateStaticUI(sym, d);
    updateTickerPrice(sym, d.price, d.change);
    try { if (orderbook) updateOrderbookWidget(orderbook, d); } catch(e) {}

    // â”€â”€ 9. KI-Analyse â”€â”€
    try {
      sub.textContent = 'Claude KI generiert Analyse...';
      const now = new Date();
      const dateStr = now.toLocaleDateString('de-DE', {day:'2-digit', month:'long', year:'numeric'});
      const analysis = await getAIAnalysis(sym, d);
      document.getElementById('aiBody').textContent = analysis;
      document.getElementById('aiTitle').textContent =
        `${d.name.toUpperCase()} (${sym}) â€“ DAYTRADER ANALYSE Â· ${dateStr.toUpperCase()}`;
    } catch(e) {
      const now = new Date();
      const dateStr = now.toLocaleDateString('de-DE', {day:'2-digit', month:'long', year:'numeric'});
      document.getElementById('aiTitle').textContent = `${d.name.toUpperCase()} (${sym}) â€“ ANALYSE Â· ${dateStr.toUpperCase()}`;
      document.getElementById('aiBody').textContent =
        `${d.name} (${sym}) | Kurs: ${d.price} | RSI: ${d.rsi} | Signal: ${SIGNAL_LABELS[d.signal].text}\nSupport: ${d.sup1} | Widerstand: ${d.res1}\nâš¡ Stop: ${d.stop} Â· TP1: ${d.tp1}`;
    }

  } catch(err) {
    // Kompletter Fallback â€“ UI trotzdem zeigen
    console.warn('runAnalysis Fehler:', err);
    try { updateStaticUI(sym, d); } catch(e) {}
    document.getElementById('aiTitle').textContent = `${d.name.toUpperCase()} (${sym}) â€“ OFFLINE MODUS`;
    document.getElementById('aiBody').textContent = `Live-Daten konnten nicht geladen werden.\nFallback-Daten werden angezeigt.\n\nKurs: ${d.price} | Signal: ${SIGNAL_LABELS[d.signal]?.text || 'HALTEN'}`;
  } finally {
    // Overlay IMMER schlieÃŸen â€“ egal was passiert
    clearTimeout(escapeTimer);
    overlay.classList.remove('active');
    btn.disabled = false;
  }

  // â”€â”€ 10. Auto-Refresh alle 30 Sek via Binance â”€â”€
  clearTimeout(window._priceRefreshTimer);
  window._priceRefreshTimer = setTimeout(async () => {
    if (sym !== currentCoin) return;
    try {
      const fresh = await fetchBinanceTicker(sym);
      if (fresh) {
        COIN_DATA[sym].price  = fmtPrice(fresh.price);
        COIN_DATA[sym].change = fresh.change24h != null ? fresh.change24h.toFixed(2) : COIN_DATA[sym].change;
        COIN_DATA[sym].h24    = fmtPrice(fresh.high24h);
        COIN_DATA[sym].l24    = fmtPrice(fresh.low24h);
        const chg = parseFloat(COIN_DATA[sym].change);
        document.getElementById('priceValue').textContent = COIN_DATA[sym].price;
        const ce = document.getElementById('priceChange');
        ce.textContent = `${chg >= 0 ? 'â–² +' : 'â–¼ '}${COIN_DATA[sym].change}% (24H)`;
        ce.className = 'price-change ' + (chg >= 0 ? 'up' : 'down');
        const clp = document.getElementById('chartLivePrice');
        const clc = document.getElementById('chartLiveChange');
        if (clp) clp.textContent = COIN_DATA[sym].price;
        if (clc) { clc.textContent = (chg >= 0 ? 'â–² +' : 'â–¼ ') + COIN_DATA[sym].change + '%'; clc.className = chg >= 0 ? 'up' : 'down'; }
        updateTickerPrice(sym, COIN_DATA[sym].price, COIN_DATA[sym].change);
      }
      const fg = await fetchFearGreed();
      if (fg) {
        const n = document.getElementById('fearNeedle');
        const s = document.getElementById('fearScore');
        const l = document.getElementById('fearLabel');
        if (n) n.style.left = fg.value + '%';
        if (s) { s.textContent = fg.value; s.style.color = fg.value < 40 ? 'var(--red)' : fg.value < 60 ? 'var(--yellow)' : 'var(--green)'; }
        if (l) l.textContent = fg.label.toUpperCase();
      }
    } catch(e) {}
  }, 30000);
}

function updateTickerPrice(sym, price, change) {
  const chg = parseFloat(change);
  const tickerItems = document.querySelectorAll('.ticker-item');
  tickerItems.forEach(item => {
    const symEl = item.querySelector('.tk-sym');
    if (!symEl) return;
    if (symEl.textContent === sym) {
      const spans = item.querySelectorAll('span');
      if (spans[1]) spans[1].textContent = price;
      if (spans[2]) {
        spans[2].textContent = (chg >= 0 ? 'â–² +' : 'â–¼ ') + Math.abs(chg).toFixed(2) + '%';
        spans[2].className = chg >= 0 ? 'tk-up' : 'tk-down';
      }
    }
  });
}

// Ticker Fear&Greed + Marktcap live updaten
function updateTickerMeta(fearVal, fearLbl, marketCapStr) {
  document.querySelectorAll('.ticker-item').forEach(item => {
    const symEl = item.querySelector('.tk-sym');
    if (!symEl) return;
    if (symEl.textContent === 'FEAR & GREED') {
      const spans = item.querySelectorAll('span');
      if (spans[1]) {
        const color = fearVal < 40 ? 'tk-down' : fearVal < 60 ? '' : 'tk-up';
        spans[1].className = color;
        spans[1].textContent = `${fearVal} â€“ ${fearLbl}`;
      }
    }
    if (symEl.textContent === 'MARKTCAP GESAMT' && marketCapStr) {
      const spans = item.querySelectorAll('span');
      if (spans[1]) spans[1].textContent = marketCapStr;
    }
  });
}

function updateOrderbookWidget(orderbook, d) {
  // Coin-Label
  const sym = currentCoin;
  const el = document.getElementById('obCoinLabel');
  if (el) el.textContent = sym + ' / USDT';

  // Bid/Ask-Balken
  const bidPct = parseFloat(orderbook.bidPct) || 50;
  const askPct = parseFloat(orderbook.askPct) || 50;
  const fill = document.getElementById('obBidFill');
  const bPct = document.getElementById('obBidPct');
  const aPct = document.getElementById('obAskPct');
  if (fill) fill.style.width = bidPct + '%';
  if (bPct) bPct.textContent = bidPct + '%';
  if (aPct) aPct.textContent = askPct + '%';

  // Spread
  const spreadEl = document.getElementById('obSpread');
  if (spreadEl && d._spread) {
    spreadEl.textContent = `Spread: ${d._spread}  |  Best Bid: ${fmtPrice(orderbook.bestBid)}  |  Best Ask: ${fmtPrice(orderbook.bestAsk)}`;
  }

  // Orderbook-Zeilen (simuliert aus Bid/Ask + aktuellen Preis)
  const p = parseFloat((d.price||'0').replace(/[$,]/g, '')) || 1;
  const rows = [];
  for (let i = 4; i >= 0; i--) {
    const askP = orderbook.bestAsk ? orderbook.bestAsk * (1 + i * 0.0008) : p * (1 + (i+1) * 0.0008);
    const bidP = orderbook.bestBid ? orderbook.bestBid * (1 - i * 0.0008) : p * (1 - (i+1) * 0.0008);
    const bidVol = (Math.random() * 800 + 100).toFixed(0);
    const askVol = (Math.random() * 800 + 100).toFixed(0);
    rows.push({ askP, askVol, bidP, bidVol, isMid: i === 0 });
  }

  const obRowsEl = document.getElementById('obRows');
  if (obRowsEl) {
    obRowsEl.innerHTML = `<div class="ob-row ob-header"><span>Menge (Bid)</span><span>Preis</span><span>Menge (Ask)</span></div>` +
      rows.map(r => `
        <div class="ob-row">
          <span class="ob-bid-val">${r.bidVol}</span>
          <span class="ob-price-val">${fmtPrice(r.isMid ? p : r.askP)}</span>
          <span class="ob-ask-val">${r.askVol}</span>
        </div>`).join('');
  }

  // â”€â”€ Binance-Stats Widget â”€â”€
  const priceSig = parseFloat(d.change) >= 0 ? 'sig-buy' : 'sig-sell';
  const priceDir = parseFloat(d.change) >= 0 ? 'â–² STEIGT' : 'â–¼ FÃ„LLT';
  setStat('bsPrice',     d.price,   priceSig,  priceDir);
  setStat('bsBidAsk',
    orderbook.bestBid ? `${fmtPrice(orderbook.bestBid)} / ${fmtPrice(orderbook.bestAsk)}` : 'â€“',
    'sig-neutral', d._spread ? `SPREAD ${d._spread}` : 'â€“');

  const volRatio = parseFloat(d._volRatio) || 1;
  const volSig   = volRatio > 1.8 ? 'sig-buy' : volRatio < 0.5 ? 'sig-sell' : 'sig-neutral';
  const volTxt   = volRatio > 1.8 ? `${volRatio}x HOCH` : volRatio < 0.5 ? `${volRatio}x NIEDRIG` : `${volRatio}x NORMAL`;
  setStat('bsVolRatio', d._volRatio ? d._volRatio + 'x' : 'â€“', volSig, volTxt);

  // ATR aus Stop-Preis rÃ¼ckrechnen (p - stop = 1.5 * ATR)
  const stopNum = parseFloat((d.stop||'0').replace(/[$,]/g,''));
  const atrEst  = stopNum > 0 ? ((p - stopNum) / 1.5) : null;
  setStat('bsAtr', atrEst ? fmtPrice(atrEst) : 'â€“', 'sig-neutral',
    atrEst ? (atrEst/p*100).toFixed(2) + '% VOM KURS' : 'â€“');

  // Trades
  const trades = d._trades;
  setStat('bsTrades', trades ? parseInt(trades).toLocaleString('de-DE') : 'â€“',
    'sig-neutral', trades > 500000 ? 'AKTIV' : trades > 100000 ? 'NORMAL' : 'â€“');

  // Orderbook-Druck
  const obSig = orderbook.pressure === 'buy' ? 'sig-buy' : orderbook.pressure === 'sell' ? 'sig-sell' : 'sig-neutral';
  const obTxt = orderbook.pressure === 'buy' ? 'â–² KAUFDRUCK' : orderbook.pressure === 'sell' ? 'â–¼ VERKAUFSDRUCK' : 'â†’ AUSGEGLICHEN';
  setStat('bsObPressure', `${bidPct}% / ${askPct}%`, obSig, obTxt);
}

function setStat(id, val, sigClass, sigText) {
  const valEl = document.getElementById(id);
  const sigEl = document.getElementById(id + 'Sig');
  if (valEl) valEl.textContent = val;
  if (sigEl) { sigEl.className = 'ind-signal ' + sigClass; sigEl.textContent = sigText; }
}

function updateStaticUI(sym, d) {
  // Logo & title
  const select = document.getElementById('coinSelect');
  const opt = select.options[select.selectedIndex];
  document.getElementById('logoIcon').textContent = opt.dataset.symbol || sym.slice(0,3);
  document.getElementById('dashTitle').textContent = sym + ' SIGNAL';
  document.getElementById('heroBg').textContent = sym;
  const nowFooter = new Date();
  document.getElementById('footerBrand').textContent = sym + ' SIGNAL DASHBOARD Â· ' + nowFooter.toLocaleDateString('de-DE', {month:'long', year:'numeric'}).toUpperCase();
  document.getElementById('indTitle').textContent = `Technische Indikatoren Â· ${sym}`;

  // Price hero
  document.getElementById('priceValue').textContent = d.price;
  const chg = parseFloat(d.change);
  const chgEl = document.getElementById('priceChange');
  chgEl.textContent = `${chg >= 0 ? 'â–² +' : 'â–¼ '}${d.change}% (24H)`;
  chgEl.className = 'price-change ' + (chg >= 0 ? 'up' : 'down');
  document.getElementById('stat24hH').textContent = d.h24;
  document.getElementById('stat24hL').textContent = d.l24;
  const p7El = document.getElementById('stat7d');
  p7El.textContent = (parseFloat(d.p7d) >= 0 ? '+' : '') + d.p7d + '%';
  p7El.style.color = parseFloat(d.p7d) >= 0 ? 'var(--green)' : 'var(--red)';
  const p30El = document.getElementById('stat30d');
  p30El.textContent = (parseFloat(d.p30d) >= 0 ? '+' : '') + d.p30d + '%';
  p30El.style.color = parseFloat(d.p30d) >= 0 ? 'var(--green)' : 'var(--red)';

  // Signal
  const sig = SIGNAL_LABELS[d.signal];
  const box = document.getElementById('signalBox');
  box.className = 'signal-box ' + sig.cls;
  document.getElementById('signalValue').textContent = sig.text;
  document.getElementById('signalSub').textContent = sig.sub;
  document.getElementById('signalConf').textContent = `âš¡ Konfidenz: ${d.conf}% Â· ${d.signal.toUpperCase()} | RSI: ${d.rsi}`;

  // Levels
  document.getElementById('levelsTable').innerHTML = `
    <div class="level-row"><span class="level-label">Widerstand 2</span><span class="level-price" style="color:var(--red)">${d.res2}</span><span class="level-type res">RES</span></div>
    <div class="level-row"><span class="level-label">Widerstand 1</span><span class="level-price" style="color:var(--red)">${d.res1}</span><span class="level-type res">RES</span></div>
    <div class="level-row"><span class="level-label">AKTUELL â–¶</span><span class="level-price" style="color:var(--accent)">${d.cur}</span><span class="level-type cur">LIVE</span></div>
    <div class="level-row"><span class="level-label">Support 1</span><span class="level-price" style="color:var(--green)">${d.sup1}</span><span class="level-type sup">SUP</span></div>
    <div class="level-row"><span class="level-label">Support 2</span><span class="level-price" style="color:var(--green)">${d.sup2}</span><span class="level-type sup">SUP</span></div>
  `;

  // â”€â”€ Szenario-Wahrscheinlichkeiten dynamisch aus echten Indikatoren â”€â”€
  const rsiV  = parseFloat(d.rsi)  || 50;
  const chgV  = parseFloat(d.change) || 0;
  const macdV = parseFloat(d.macd)  || 0;
  // Bullish-Score aus RSI (Ã¼berverkauft=bullish), MACD, 24h-Change
  let bullScore = 0;
  if (rsiV < 30)  bullScore += 25;
  else if (rsiV < 40) bullScore += 12;
  else if (rsiV > 70) bullScore -= 20;
  if (macdV > 0)  bullScore += 15; else bullScore -= 10;
  if (chgV > 3)   bullScore += 10; else if (chgV < -3) bullScore -= 10;
  bullScore = Math.max(-30, Math.min(30, bullScore));
  const scB  = Math.max(10, Math.min(60, 30 + bullScore));
  const scBr = Math.max(10, Math.min(55, 30 - bullScore));
  const scN  = Math.max(10, 100 - scB - scBr);
  d.scB = scB; d.scBr = scBr; d.scN = scN;

  // â”€â”€ Konfidenz aus Anzahl Ã¼bereinstimmender Signale â”€â”€
  const signals = [
    rsiV < 30 ? 'buy' : rsiV > 70 ? 'sell' : 'neutral',
    macdV > 0 ? 'buy' : 'sell',
    d.willSig || 'neutral',
    d.ma5sig  || 'neutral',
    d.ma50sig || 'neutral',
  ];
  const dominant = d.signal;
  const matches = signals.filter(s => s === dominant).length;
  d.conf = String(40 + matches * 12);
  document.getElementById('signalConf').textContent = `âš¡ Konfidenz: ${d.conf}% Â· ${d.signal.toUpperCase()} | RSI: ${d.rsi}`;

  // â”€â”€ Risiko dynamisch aus RSI + VolatilitÃ¤t (BB) + Coin-Tier â”€â”€
  const bbV = parseFloat(d.bb) || 0.15;
  const volatilityRisk = bbV > 0.25 ? 2 : bbV > 0.15 ? 1 : 0;
  const rsiRisk = (rsiV < 20 || rsiV > 80) ? 1 : 0;
  const tierRisk = ['BTC','BNB'].includes(sym) ? 0 : ['ETH','LTC','LINK'].includes(sym) ? 1 : ['SOL','XRP','ADA','AVAX','DOT'].includes(sym) ? 2 : 3;
  d.risk = Math.min(5, Math.max(1, 1 + tierRisk + volatilityRisk + rsiRisk));

  // Circles & Labels
  const riskConfig2 = [[1,0,0,0,0],[1,1,0,0,0],[1,1,1,0,0],[1,1,1,1,0],[1,1,1,1,1]];
  const rc2 = riskConfig2[d.risk - 1];
  const circleSymbols2 = ['!','!','!','~','Â·'];
  document.getElementById('riskCircles').innerHTML = rc2.map((v,i) =>
    `<div class="risk-circle ${v ? (i < 3 ? 'rc-filled-red' : 'rc-filled-yellow') : 'rc-empty'}">${circleSymbols2[i]}</div>`
  ).join('');
  const riskLabels2 = ['','SEHR NIEDRIG (1/5)','NIEDRIG (2/5)','HOCH (3/5)','SEHR HOCH (4/5)','EXTREM (5/5) Â· NUR EXPERTEN'];
  document.getElementById('riskLabel').textContent = riskLabels2[d.risk] + ' Â· STOP-LOSS PFLICHT';

  // Szenarien
  const animate = (id, pct) => {
    const el = document.getElementById(id);
    el.style.width = '0%';
    setTimeout(() => { el.style.width = pct + '%'; }, 100);
  };
  animate('scNeutral', d.scN); document.getElementById('scNeutralPct').textContent = d.scN + '%';
  animate('scBull', d.scB);    document.getElementById('scBullPct').textContent = d.scB + '%';
  animate('scBear', d.scBr);   document.getElementById('scBearPct').textContent = d.scBr + '%';

  // Fear
  const fearPct = d.fear;
  document.getElementById('fearNeedle').style.left = fearPct + '%';
  document.getElementById('fearScore').textContent = fearPct;
  document.getElementById('fearLabel').textContent = fearPct < 25 ? 'EXTREME ANGST' : fearPct < 45 ? 'ANGST' : fearPct < 55 ? 'NEUTRAL' : fearPct < 75 ? 'GIER' : 'EXTREME GIER';
  document.getElementById('fearScore').style.color = fearPct < 40 ? 'var(--red)' : fearPct < 60 ? 'var(--yellow)' : 'var(--green)';

  // Chart labels â€“ echte Daten der letzten Tage
  const today = new Date();
  const fmtDay = d => d.toLocaleDateString('de-DE', {day:'2-digit', month:'2-digit'});
  const d2 = new Date(today); d2.setDate(today.getDate() - 6);
  const d3 = new Date(today); d3.setDate(today.getDate() - 3);
  const d4 = new Date(today); d4.setDate(today.getDate() - 1);
  document.getElementById('cl1').textContent = fmtDay(d2);
  document.getElementById('cl2').textContent = fmtDay(d3);
  document.getElementById('cl3').textContent = fmtDay(d4);
  document.getElementById('chartPriceText').textContent = d.price;
  document.getElementById('chartSupText').textContent = `SUPPORT ${d.sup1}`;
  document.getElementById('chartResText').textContent = `WIDERSTAND ${d.res1}`;

  // Indikatoren-Tabelle komplett neu rendern
  const sigClass = { buy:'sig-buy', sell:'sig-sell', neutral:'sig-neutral' };
  const sigColor = { buy:'var(--green)', sell:'var(--red)', neutral:'var(--yellow)' };
  const sigText  = { buy:'KAUFEN', sell:'VERKAUFEN', neutral:'NEUTRAL' };

  const rsiColor = parseFloat(d.rsi) < 30 ? 'var(--green)' : parseFloat(d.rsi) > 70 ? 'var(--red)' : 'var(--yellow)';
  const rsiSigTxt = parseFloat(d.rsi) < 30 ? 'ÃœBERVERKAUFT' : parseFloat(d.rsi) > 70 ? 'ÃœBERKAUFT' : 'NEUTRAL';
  const rsiSigCls = parseFloat(d.rsi) < 30 ? 'sig-buy' : parseFloat(d.rsi) > 70 ? 'sig-sell' : 'sig-neutral';

  const macdColor = d.macdSig === 'buy' ? 'var(--green)' : d.macdSig === 'sell' ? 'var(--red)' : 'var(--yellow)';
  const ma5Color  = d.ma5sig === 'buy'  ? 'var(--green)' : 'var(--red)';
  const ma50Color = d.ma50sig === 'buy' ? 'var(--green)' : 'var(--red)';

  document.getElementById('indicatorsTable').innerHTML = `
    <div class="indicator-row">
      <span class="ind-name">RSI (14)</span>
      <span class="ind-val" style="color:${rsiColor}">${d.rsi}</span>
      <span class="ind-signal ${rsiSigCls}">${rsiSigTxt}</span>
    </div>
    <div class="indicator-row">
      <span class="ind-name">MACD (12,26)</span>
      <span class="ind-val" style="color:${macdColor}">${d.macd}</span>
      <span class="ind-signal ${sigClass[d.macdSig]}">${d.macdSig === 'buy' ? 'BULLISCH' : d.macdSig === 'sell' ? 'BÃ„RISCH' : 'NEUTRAL'}</span>
    </div>
    <div class="indicator-row">
      <span class="ind-name">Williams %R</span>
      <span class="ind-val" style="color:${sigColor[d.willSig]}">${d.williams}</span>
      <span class="ind-signal ${sigClass[d.willSig]}">${d.willSig === 'buy' ? 'ÃœBERVERKAUFT' : d.willSig === 'sell' ? 'ÃœBERKAUFT' : 'NEUTRAL'}</span>
    </div>
    <div class="indicator-row">
      <span class="ind-name">MA 5 (SMA)</span>
      <span class="ind-val" style="color:${ma5Color}">${d.ma5}</span>
      <span class="ind-signal ${sigClass[d.ma5sig]}">${sigText[d.ma5sig]}</span>
    </div>
    <div class="indicator-row">
      <span class="ind-name">MA 50 (SMA)</span>
      <span class="ind-val" style="color:${ma50Color}">${d.ma50}</span>
      <span class="ind-signal ${sigClass[d.ma50sig]}">${sigText[d.ma50sig]}</span>
    </div>
    <div class="indicator-row">
      <span class="ind-name">Bollinger Bands</span>
      <span class="ind-val" style="color:var(--yellow)">${d.bb}</span>
      <span class="ind-signal ${parseFloat(d.bb) > 0.2 ? 'sig-sell' : parseFloat(d.bb) < 0.08 ? 'sig-buy' : 'sig-neutral'}">${parseFloat(d.bb) > 0.2 ? 'WEIT' : parseFloat(d.bb) < 0.08 ? 'ENG' : 'NORMAL'}</span>
    </div>
    <div class="indicator-row">
      <span class="ind-name">Volumen (24H)</span>
      <span class="ind-val" style="color:var(--accent)">${d.vol}</span>
      <span class="ind-signal ${d.volSig === 'hoch' ? 'sig-buy' : d.volSig === 'niedrig' ? 'sig-sell' : 'sig-neutral'}">${d.volSig.toUpperCase()}</span>
    </div>
  `;

  // â”€â”€ Sentiment-Rows aus echten Indikatoren ableiten â”€â”€
  const fgVal = d.fear || 50;
  // News-Sentiment: Fear&Greed (60%) + RSI-Inversion (40%)
  const newsSentScore = Math.round(Math.min(100, Math.max(0, fgVal * 0.6 + (100 - rsiV) * 0.4)));
  const newsSentColor = newsSentScore > 60 ? 'var(--green)' : newsSentScore < 40 ? 'var(--red)' : 'var(--yellow)';
  const newsSentSig   = newsSentScore > 60 ? 'sig-buy' : newsSentScore < 40 ? 'sig-sell' : 'sig-neutral';
  const newsSentLabel = newsSentScore > 60 ? 'POSITIV' : newsSentScore < 40 ? 'NEGATIV' : 'NEUTRAL';
  // Kapitalfluss: aus 24h-Change + Volumen
  const chgF   = parseFloat(d.change) || 0;
  const capDir = chgF > 2 ? 'ZUFLUSS' : chgF < -2 ? 'ABFLUSS' : 'STABIL';
  const capClr = chgF > 2 ? 'var(--green)' : chgF < -2 ? 'var(--red)' : 'var(--yellow)';
  const capSig = chgF > 2 ? 'sig-buy' : chgF < -2 ? 'sig-sell' : 'sig-neutral';
  // Marktkapitalisierung aus live Daten
  const mcapLive = d._marketCap ? fmtMarketCap(d._marketCap) : 'â€“';
  const mcapClr  = parseFloat(d.p30d) > 0 ? 'var(--green)' : 'var(--red)';
  const mcapSig  = parseFloat(d.p30d) > 5 ? 'sig-buy' : parseFloat(d.p30d) < -15 ? 'sig-sell' : 'sig-neutral';
  const mcapTxt  = parseFloat(d.p30d) > 5 ? 'WACHSEND' : parseFloat(d.p30d) < -15 ? 'FALLEND' : 'STABIL';

  document.getElementById('sentimentRows').innerHTML = `
    <div class="indicator-row">
      <span class="ind-name">News-Sentiment</span>
      <span class="ind-val" style="color:${newsSentColor}">${newsSentScore}/100</span>
      <span class="ind-signal ${newsSentSig}">${newsSentLabel}</span>
    </div>
    <div class="indicator-row">
      <span class="ind-name">Kapitalfluss (24H)</span>
      <span class="ind-val" style="color:${capClr}">${capDir}</span>
      <span class="ind-signal ${capSig}">${capDir}</span>
    </div>
    <div class="indicator-row">
      <span class="ind-name">Marktkapitalisierung</span>
      <span class="ind-val" style="color:${mcapClr}">${mcapLive}</span>
      <span class="ind-signal ${mcapSig}">${mcapTxt}</span>
    </div>
  `;
  document.getElementById('scNeutralText').textContent = `${d.sup1} â€“ ${d.res1} Â· Konsolidierung`;
  document.getElementById('scBullText').textContent = `${d.res1} â€“ ${d.res2} Â· Ausbruch nÃ¶tig`;
  document.getElementById('scBearText').textContent = `${d.sup2} â€“ ${d.sup1} Â· AbwÃ¤rtsdruck`;

  // Playbook komplett neu rendern
  const isLeverageOk = d.risk <= 2;
  const leverageTip = isLeverageOk
    ? `RSI ${d.rsi} & Markt stabil â€“ moderater Hebel (2â€“3x) mÃ¶glich.`
    : `RSI ${d.rsi} & Risiko ${d.risk}/5 â€“ <strong>kein Leverage</strong>. Zu hohes Liquidationsrisiko.`;

  document.getElementById('playbookContent').innerHTML = `
    <div class="tip-row">
      <span class="tip-icon">ğŸ¯</span>
      <span class="tip-text"><strong>Einstieg Long:</strong> Nur bei bestÃ¤tigtem Ausbruch Ã¼ber <strong>${d.entryLong}</strong> mit Volumen. Nicht vorher kaufen.</span>
    </div>
    <div class="tip-row">
      <span class="tip-icon">ğŸ›‘</span>
      <span class="tip-text"><strong>Stop-Loss:</strong> Unter <strong>${d.stop}</strong> setzen. Kein Trade ohne Stop in diesem Markt.</span>
    </div>
    <div class="tip-row">
      <span class="tip-icon">ğŸ“ˆ</span>
      <span class="tip-text"><strong>Take Profit:</strong> Erstes Ziel <strong>${d.tp1}</strong>, Zweites Ziel <strong>${d.tp2}</strong>. Gewinne sichern!</span>
    </div>
    <div class="tip-row">
      <span class="tip-icon">ğŸ‘€</span>
      <span class="tip-text"><strong>Markt-Kontext:</strong> ${d.btcNote}</span>
    </div>
    <div class="tip-row">
      <span class="tip-icon">âš¡</span>
      <span class="tip-text">${leverageTip}</span>
    </div>
  `;

  // Risiko-Text
  const riskTexts = [
    '', 
    `${d.name} gilt als <strong style="color:var(--green)">vergleichsweise stabil</strong>. Dennoch Stop-Loss setzen.`,
    `${d.name} hat <strong style="color:var(--green)">moderates Risiko</strong>. Stop-Loss und PositionsgrÃ¶ÃŸe beachten.`,
    `${d.name} befindet sich in einer <strong style="color:var(--yellow)">Hochrisiko-Zone</strong>. Strenge Stop-Losses sind Pflicht.`,
    `${d.name} zeigt <strong style="color:var(--orange)">sehr hohes Risiko</strong>. Nur kleine Positionen, enger Stop.`,
    `${d.name} ist <strong style="color:var(--red)">extrem riskant</strong>. Nur fÃ¼r erfahrene Trader mit kleiner Position.`
  ];
  document.getElementById('riskText').innerHTML = riskTexts[d.risk];

  // Haupt-Chart aktualisieren
  updateMainChart(sym);
}

async function getAIAnalysis(sym, d) {
  const now = new Date();
  const dateStr = now.toLocaleDateString('de-DE', {day:'2-digit', month:'long', year:'numeric'});
  const prompt = `Du bist ein professioneller Krypto-Analyst mit Fokus auf Daytrading. Erstelle eine prÃ¤zise, professionelle Kurzanalyse fÃ¼r ${d.name} (${sym}) auf Deutsch.

Aktuelle Marktdaten (${dateStr}):
- Kurs: ${d.price} | 24H: ${d.change}% | 7T: ${d.p7d}% | 30T: ${d.p30d}%
- RSI (14): ${d.rsi} | MACD: ${d.macd} | Williams %R: ${d.williams}
- MA5: ${d.ma5} | MA50: ${d.ma50} | Volumen 24H: ${d.vol}
- Support: ${d.sup1} / ${d.sup2} | Widerstand: ${d.res1} / ${d.res2}
- Signal: ${SIGNAL_LABELS[d.signal].text} | Konfidenz: ${d.conf}% | Risiko: ${d.risk}/5
- Fear & Greed Index: ${d.fear}
- Einstieg Long: ${d.entryLong} | Stop-Loss: ${d.stop}
- Take Profit 1: ${d.tp1} | Take Profit 2: ${d.tp2}

Erstelle eine strukturierte Analyse mit genau diesen 4 Abschnitten:
1. KurzÃ¼berblick zur aktuellen Lage (2-3 SÃ¤tze, konkret auf ${sym} bezogen)
2. ğŸ“ KURZFRISTIG (1-2 Tage): Konkrete Erwartung mit Kurszielen
3. ğŸ“ MITTELFRISTIG (3-7 Tage): Hauptszenario mit Wahrscheinlichkeit
4. âš¡ DAYTRADER EMPFEHLUNG: Klarer Rat (Kaufen/Halten/Verkaufen) mit den obigen Einstieg/Stop/TP-Levels

Wichtig: Beziehe dich immer namentlich auf ${sym}/${d.name}, nie auf andere Coins. Maximal 220 WÃ¶rter. Professionell und prÃ¤zise.`;

  const response = await fetch('https://api.anthropic.com/v1/messages', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      model: 'claude-sonnet-4-5-20250929',
      max_tokens: 1000,
      messages: [{ role: 'user', content: prompt }]
    })
  });

  if (!response.ok) throw new Error('API error');
  const data = await response.json();
  return data.content.map(b => b.text || '').join('');
}

// ======================================================
// HAUPT-CHART ENGINE
// ======================================================
let currentChartRange = '7d';
let currentChartCoin  = 'XRP';

const RANGE_LABELS = {
  '3d':  'letzte 3 Tage',
  '7d':  'letzte 7 Tage',
  '30d': 'letzte 30 Tage',
  '3m':  'letzte 3 Monate',
  '1y':  'letztes Jahr',
  '5y':  'letzte 5 Jahre',
  'f24h':'Prognose nÃ¤chste 24 Stunden',
  'f3d': 'Prognose nÃ¤chste 3 Tage',
  'f7d': 'Prognose nÃ¤chste 7 Tage',
};

// Realistischen Kursverlauf aus Basiskurs simulieren
function generateChartData(coin, range) {
  const d = COIN_DATA[coin];
  const basePrice = parseFloat(d.price.replace(/[$,]/g, '')) || 1;
  const isForecast = range.startsWith('f');

  // Punktanzahl & VolatilitÃ¤t je Range
  const config = {
    '3d':  { points: 72,  vol: 0.018, trend: parseFloat(d.p7d)/100/7*3 },
    '7d':  { points: 168, vol: 0.022, trend: parseFloat(d.p7d)/100 },
    '30d': { points: 120, vol: 0.04,  trend: parseFloat(d.p30d)/100 },
    '3m':  { points: 90,  vol: 0.07,  trend: parseFloat(d.p30d)/100 * 3 },
    '1y':  { points: 104, vol: 0.12,  trend: -0.35 },
    '5y':  { points: 130, vol: 0.18,  trend: 1.8 },
    'f24h':{ points: 48,  vol: 0.012, trend: parseFloat(d.change)/100 * 0.5 },
    'f3d': { points: 72,  vol: 0.02,  trend: parseFloat(d.p7d)/100/7*3 * 0.6 },
    'f7d': { points: 84,  vol: 0.03,  trend: parseFloat(d.p7d)/100 * 0.5 },
  };
  const { points, vol, trend } = config[range];

  // Historisch: rÃ¼ckwÃ¤rts vom aktuellen Kurs aufbauen
  // Prognose: vorwÃ¤rts vom aktuellen Kurs
  let prices = [];
  let price = basePrice;

  if (!isForecast) {
    // Startpreis aus Trend berechnen (wo war der Kurs vor X Zeit)
    const startPrice = basePrice / (1 + trend);
    price = startPrice;
    for (let i = 0; i < points; i++) {
      const progress = i / points;
      const trendStep = trend / points;
      // Brownsche Bewegung + Trend
      const noise = (Math.random() - 0.48) * vol * price;
      price = price * (1 + trendStep) + noise;
      price = Math.max(price, basePrice * 0.05); // Floor
      prices.push(price);
    }
    // Letzten Punkt auf aktuellen Preis fixieren
    prices[prices.length - 1] = basePrice;
  } else {
    price = basePrice;
    const bullishBias = d.signal === 'buy' ? 0.52 : d.signal === 'sell' ? 0.47 : 0.50;
    for (let i = 0; i < points; i++) {
      const noise = (Math.random() - (1 - bullishBias)) * vol * price;
      price = price * (1 + trend / points) + noise;
      price = Math.max(price, basePrice * 0.5);
      prices.push(price);
    }
  }

  return prices;
}

// Zeitlabels generieren
function generateLabels(range) {
  const now = new Date();
  const labels = [];
  const config = {
    '3d':  { step: 4,  unit:'h',  count:72 },
    '7d':  { step: 12, unit:'h',  count:168 },
    '30d': { step: 6,  unit:'h',  count:120 },
    '3m':  { step: 1,  unit:'d',  count:90 },
    '1y':  { step: 5,  unit:'d',  count:104 },
    '5y':  { step: 14, unit:'d',  count:130 },
    'f24h':{ step: 1,  unit:'fh', count:48 },
    'f3d': { step: 2,  unit:'fh', count:72 },
    'f7d': { step: 4,  unit:'fh', count:84 },
  };
  const { step, unit, count } = config[range];

  for (let i = 0; i < count; i++) {
    const d = new Date(now);
    if (unit === 'h') {
      d.setHours(now.getHours() - (count - i) * step);
      if (i % (count / 6 | 0) === 0) {
        labels.push(d.toLocaleDateString('de-DE',{day:'2-digit',month:'2-digit'}));
      } else labels.push('');
    } else if (unit === 'd') {
      d.setDate(now.getDate() - (count - i) * step);
      if (i % (count / 6 | 0) === 0) {
        labels.push(d.toLocaleDateString('de-DE',{day:'2-digit',month:'2-digit',year:'2-digit'}));
      } else labels.push('');
    } else {
      d.setHours(now.getHours() + i * step);
      if (i % (count / 6 | 0) === 0) {
        labels.push('+' + Math.round(i * step) + 'h');
      } else labels.push('');
    }
  }
  return labels;
}

let chartInstance = null;

function drawChart(coin, range) {
  const canvas = document.getElementById('mainChart');
  if (!canvas) return;
  const ctx = canvas.getContext('2d');

  const isForecast = range.startsWith('f');
  const prices = generateChartData(coin, range);
  const labels = generateLabels(range);
  const d = COIN_DATA[coin];
  const basePrice = parseFloat(d.price.replace(/[$,]/g, '')) || 1;

  const minP = Math.min(...prices);
  const maxP = Math.max(...prices);
  const pad = (maxP - minP) * 0.12;
  const yMin = minP - pad;
  const yMax = maxP + pad;

  // Canvas size
  const W = canvas.offsetWidth || 900;
  const H = 280;
  canvas.width = W * window.devicePixelRatio;
  canvas.height = H * window.devicePixelRatio;
  canvas.style.width = W + 'px';
  canvas.style.height = H + 'px';
  ctx.scale(window.devicePixelRatio, window.devicePixelRatio);

  const PADDING = { top: 20, right: 70, bottom: 42, left: 72 };
  const chartW = W - PADDING.left - PADDING.right;
  const chartH = H - PADDING.top - PADDING.bottom;

  ctx.clearRect(0, 0, W, H);

  // Map helpers
  const xPos = i => PADDING.left + (i / (prices.length - 1)) * chartW;
  const yPos = v => PADDING.top + (1 - (v - yMin) / (yMax - yMin)) * chartH;

  // === BACKGROUND GRADIENT ===
  const bgGrad = ctx.createLinearGradient(0, 0, 0, H);
  bgGrad.addColorStop(0, 'rgba(8,15,30,0)');
  bgGrad.addColorStop(1, 'rgba(4,8,16,0)');
  ctx.fillStyle = bgGrad;
  ctx.fillRect(0, 0, W, H);

  // === GRID LINES ===
  ctx.strokeStyle = 'rgba(13,42,69,0.7)';
  ctx.lineWidth = 1;
  const gridRows = 5;
  for (let i = 0; i <= gridRows; i++) {
    const y = PADDING.top + (i / gridRows) * chartH;
    ctx.beginPath();
    ctx.setLineDash([4, 8]);
    ctx.moveTo(PADDING.left, y);
    ctx.lineTo(PADDING.left + chartW, y);
    ctx.stroke();
  }
  ctx.setLineDash([]);

  // === Y-AXIS LABELS ===
  ctx.font = '10px Share Tech Mono, monospace';
  ctx.fillStyle = '#4a6080';
  ctx.textAlign = 'right';
  for (let i = 0; i <= gridRows; i++) {
    const v = yMax - i * (yMax - yMin) / gridRows;
    const y = PADDING.top + (i / gridRows) * chartH;
    let label;
    if (v >= 10000) label = '$' + (v/1000).toFixed(1) + 'K';
    else if (v >= 1) label = '$' + v.toFixed(2);
    else if (v >= 0.01) label = '$' + v.toFixed(4);
    else label = '$' + v.toFixed(8);
    ctx.fillText(label, PADDING.left - 8, y + 4);
  }

  // === X-AXIS LABELS ===
  ctx.textAlign = 'center';
  labels.forEach((lbl, i) => {
    if (lbl) {
      const x = xPos(i);
      ctx.fillText(lbl, x, H - PADDING.bottom + 18);
    }
  });

  // === FORECAST SEPARATOR LINE ===
  if (isForecast) {
    const sepX = PADDING.left;
    ctx.strokeStyle = 'rgba(255,140,0,0.4)';
    ctx.lineWidth = 1;
    ctx.setLineDash([6, 4]);
    ctx.beginPath();
    ctx.moveTo(sepX, PADDING.top);
    ctx.lineTo(sepX, PADDING.top + chartH);
    ctx.stroke();
    ctx.setLineDash([]);
    ctx.font = '9px Share Tech Mono, monospace';
    ctx.fillStyle = 'rgba(255,140,0,0.7)';
    ctx.textAlign = 'center';
    ctx.fillText('JETZT', sepX, PADDING.top - 6);
  }

  // === AREA FILL ===
  const areaGrad = ctx.createLinearGradient(0, PADDING.top, 0, PADDING.top + chartH);
  if (isForecast) {
    areaGrad.addColorStop(0, 'rgba(255,140,0,0.18)');
    areaGrad.addColorStop(1, 'rgba(255,140,0,0.01)');
  } else {
    const isUp = prices[prices.length-1] >= prices[0];
    areaGrad.addColorStop(0, isUp ? 'rgba(0,212,255,0.2)' : 'rgba(255,58,58,0.15)');
    areaGrad.addColorStop(1, isUp ? 'rgba(0,212,255,0.01)' : 'rgba(255,58,58,0.01)');
  }
  ctx.beginPath();
  ctx.moveTo(xPos(0), yPos(prices[0]));
  for (let i = 1; i < prices.length; i++) {
    const xc = (xPos(i-1) + xPos(i)) / 2;
    const yc = (yPos(prices[i-1]) + yPos(prices[i])) / 2;
    ctx.quadraticCurveTo(xPos(i-1), yPos(prices[i-1]), xc, yc);
  }
  ctx.lineTo(xPos(prices.length-1), yPos(prices[prices.length-1]));
  ctx.lineTo(xPos(prices.length-1), yPos(yMin));
  ctx.lineTo(xPos(0), yPos(yMin));
  ctx.closePath();
  ctx.fillStyle = areaGrad;
  ctx.fill();

  // === PRICE LINE ===
  const isUp = prices[prices.length-1] >= prices[0];
  const lineColor = isForecast ? '#ff8c00' : (isUp ? '#00d4ff' : '#ff3a3a');

  ctx.beginPath();
  ctx.moveTo(xPos(0), yPos(prices[0]));
  for (let i = 1; i < prices.length; i++) {
    const xc = (xPos(i-1) + xPos(i)) / 2;
    const yc = (yPos(prices[i-1]) + yPos(prices[i])) / 2;
    ctx.quadraticCurveTo(xPos(i-1), yPos(prices[i-1]), xc, yc);
  }
  ctx.lineTo(xPos(prices.length-1), yPos(prices[prices.length-1]));

  if (isForecast) {
    ctx.setLineDash([8, 5]);
  }
  ctx.strokeStyle = lineColor;
  ctx.lineWidth = 2.5;
  ctx.lineJoin = 'round';
  ctx.stroke();
  ctx.setLineDash([]);

  // === CURRENT PRICE LINE ===
  if (!isForecast) {
    const currentY = yPos(basePrice);
    ctx.strokeStyle = 'rgba(0,212,255,0.3)';
    ctx.lineWidth = 1;
    ctx.setLineDash([3, 6]);
    ctx.beginPath();
    ctx.moveTo(PADDING.left, currentY);
    ctx.lineTo(PADDING.left + chartW, currentY);
    ctx.stroke();
    ctx.setLineDash([]);

    // Current price label on right
    ctx.fillStyle = 'rgba(0,212,255,0.9)';
    ctx.font = 'bold 10px Share Tech Mono, monospace';
    ctx.textAlign = 'left';
    let pLabel;
    if (basePrice >= 1000) pLabel = '$' + basePrice.toLocaleString('de-DE',{maximumFractionDigits:0});
    else if (basePrice >= 1) pLabel = '$' + basePrice.toFixed(2);
    else pLabel = '$' + basePrice.toPrecision(4);
    ctx.fillText(pLabel, PADDING.left + chartW + 6, currentY + 4);
  }

  // === END DOT ===
  const lastX = xPos(prices.length - 1);
  const lastY = yPos(prices[prices.length - 1]);
  ctx.beginPath();
  ctx.arc(lastX, lastY, 5, 0, Math.PI * 2);
  ctx.fillStyle = lineColor;
  ctx.fill();
  ctx.strokeStyle = '#040810';
  ctx.lineWidth = 2;
  ctx.stroke();

  // Pulsing ring (CSS animation not possible on canvas â€“ draw 2 rings)
  ctx.beginPath();
  ctx.arc(lastX, lastY, 10, 0, Math.PI * 2);
  ctx.strokeStyle = lineColor.replace(')', ',0.4)').replace('rgb','rgba');
  ctx.lineWidth = 1.5;
  ctx.stroke();

  // === TOOLTIP on mousemove ===
  const tooltip = document.getElementById('chartTooltip');
  canvas._prices = prices;
  canvas._xPos = xPos;
  canvas._yPos = yPos;
  canvas._basePrice = basePrice;
  canvas._range = range;
  canvas._lineColor = lineColor;
  canvas._PADDING = PADDING;
  canvas._chartW = chartW;
  canvas._chartH = chartH;
  canvas._yMin = yMin;
  canvas._yMax = yMax;

  // Store for hover redraws
  canvas._drawBase = () => drawChart(coin, range);

  // Mouse handler
  canvas.onmousemove = function(e) {
    const rect = canvas.getBoundingClientRect();
    const mx = e.clientX - rect.left;
    const relX = mx - PADDING.left;
    if (relX < 0 || relX > chartW) { tooltip.style.opacity = '0'; return; }
    const idx = Math.round((relX / chartW) * (prices.length - 1));
    if (idx < 0 || idx >= prices.length) return;

    const px = prices[idx];
    const pct = idx > 0 ? ((px - prices[0]) / prices[0] * 100).toFixed(2) : '0.00';
    const sign = parseFloat(pct) >= 0 ? '+' : '';
    const color = parseFloat(pct) >= 0 ? '#00ff88' : '#ff3a3a';

    let priceStr;
    if (px >= 1000) priceStr = '$' + px.toLocaleString('de-DE',{maximumFractionDigits:0});
    else if (px >= 1) priceStr = '$' + px.toFixed(2);
    else if (px >= 0.01) priceStr = '$' + px.toFixed(4);
    else priceStr = '$' + px.toFixed(8);

    const labelIdx = labels[idx] || labels.filter(l=>l)[Math.floor(idx/prices.length * labels.filter(l=>l).length)] || '';

    tooltip.innerHTML = `<span style="color:var(--accent);font-size:10px;">${labelIdx || 'â€“'}</span><br>
      <span style="font-size:13px;font-weight:700;">${priceStr}</span>
      <span style="color:${color};margin-left:6px;">${sign}${pct}%</span>`;

    const tx = mx + 14;
    const ty = e.clientY - rect.top - 30;
    tooltip.style.left = (tx + 120 > W ? tx - 140 : tx) + 'px';
    tooltip.style.top = Math.max(0, ty) + 'px';
    tooltip.style.opacity = '1';

    // Crosshair
    drawChart(coin, range);
    ctx.strokeStyle = 'rgba(255,255,255,0.15)';
    ctx.lineWidth = 1;
    ctx.setLineDash([4, 4]);
    const hx = xPos(idx);
    ctx.beginPath(); ctx.moveTo(hx, PADDING.top); ctx.lineTo(hx, PADDING.top + chartH); ctx.stroke();
    const hy = yPos(px);
    ctx.beginPath(); ctx.moveTo(PADDING.left, hy); ctx.lineTo(PADDING.left + chartW, hy); ctx.stroke();
    ctx.setLineDash([]);
    ctx.beginPath(); ctx.arc(hx, hy, 4, 0, Math.PI*2);
    ctx.fillStyle = lineColor; ctx.fill();
  };
  canvas.onmouseleave = function() {
    tooltip.style.opacity = '0';
    drawChart(coin, range);
  };
}

function setChartRange(range) {
  currentChartRange = range;
  document.querySelectorAll('.chart-btn').forEach(b => {
    b.classList.toggle('active', b.dataset.range === range);
  });
  const isForecast = range.startsWith('f');
  document.getElementById('forecastLegend').style.display = isForecast ? 'flex' : 'none';
  document.getElementById('chartRangeLabel').textContent = 'Zeitraum: ' + RANGE_LABELS[range];
  drawChart(currentChartCoin, range);
}

function updateMainChart(sym) {
  currentChartCoin = sym;
  const d = COIN_DATA[sym];
  const chg = parseFloat(d.change);
  document.getElementById('chartCardTitle').textContent = sym + ' / USD Â· KURSCHART';
  document.getElementById('chartLivePrice').textContent = d.price;
  const chgEl = document.getElementById('chartLiveChange');
  chgEl.textContent = (chg >= 0 ? 'â–² +' : 'â–¼ ') + d.change + '%';
  chgEl.className = chg >= 0 ? 'up' : 'down';
  drawChart(sym, currentChartRange);
}

// Resize handler
window.addEventListener('resize', () => {
  if (currentChartCoin) drawChart(currentChartCoin, currentChartRange);
});

// ---- LOGIN LOGIC ----
const USERS = { admin: 'Admin1' };

function doLogin() {
  try {
    var user = (document.getElementById('loginUser').value || '').trim();
    var pass = document.getElementById('loginPass').value || '';
    var errEl = document.getElementById('loginError');

    if (USERS[user] && USERS[user] === pass) {
      if (errEl) errEl.classList.remove('show');

      // Login-Screen per Klasse ausblenden (sicherer als style.display)
      var screen = document.getElementById('loginScreen');
      screen.classList.add('hidden');

      // Dashboard einblenden
      var wrapper = document.getElementById('dashboardWrapper');
      wrapper.style.display = 'block';
      wrapper.style.opacity = '0';
      wrapper.style.transition = 'opacity 0.4s ease';
      setTimeout(function() { wrapper.style.opacity = '1'; }, 30);

      // Username setzen
      var badge = document.getElementById('userBadge');
      if (badge) badge.innerHTML = '<span class="user-dot"></span>' + user.toUpperCase();

      // Portfolio initialisieren
      try { initPortfolio(); } catch(e) { console.warn('initPortfolio:', e); }

      // Analyse nach kurzem Delay starten
      setTimeout(function() {
        try { runAnalysis(); } catch(e) { console.warn('runAnalysis:', e); }
        try {
          fetchAllTickerPrices().then(function(tickers) {
            if (!tickers) return;
            Object.keys(COINGECKO_IDS).forEach(function(sym) {
              var id = COINGECKO_IDS[sym];
              var data = tickers[id];
              if (!data) return;
              var chg = data.usd_24h_change ? data.usd_24h_change.toFixed(2) : null;
              if (chg) updateTickerPrice(sym, fmtPrice(data.usd), chg);
            });
          }).catch(function() {});
        } catch(e) {}
      }, 300);

    } else {
      if (errEl) { errEl.classList.remove('show'); void errEl.offsetWidth; errEl.classList.add('show'); }
      var passEl = document.getElementById('loginPass');
      if (passEl) { passEl.value = ''; passEl.focus(); }
    }
  } catch(e) {
    console.error('doLogin Fehler:', e);
  }
}

function doLogout() {
  try {
    clearTimeout(window._priceRefreshTimer);
    var wrapper = document.getElementById('dashboardWrapper');
    wrapper.style.transition = 'opacity 0.4s ease';
    wrapper.style.opacity = '0';
    setTimeout(function() {
      wrapper.style.display = 'none';
      var screen = document.getElementById('loginScreen');
      screen.classList.remove('hidden');
      screen.style.opacity = '0';
      screen.style.transition = 'opacity 0.4s ease';
      setTimeout(function() { screen.style.opacity = '1'; }, 30);
      document.getElementById('loginUser').value = '';
      document.getElementById('loginPass').value = '';
      var err = document.getElementById('loginError');
      if (err) err.classList.remove('show');
    }, 400);
  } catch(e) { console.warn('doLogout:', e); }
}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PORTFOLIO ADVISOR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let portfolioHorizon = 3;
let portfolioRows = [];

const ALL_COINS = [
  'BTC','ETH','XRP','BNB','SOL','ADA','AVAX','DOGE',
  'DOT','LINK','MATIC','UNI','ATOM','LTC','NEAR',
  'ARB','OP','SUI','SHIB','PEPE','FLOKI'
];

function switchPage(page, tabEl) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  const pageId = 'page' + page.charAt(0).toUpperCase() + page.slice(1);
  const pageEl = document.getElementById(pageId);
  if (pageEl) pageEl.classList.add('active');
  if (tabEl) tabEl.classList.add('active');
}

function setHorizon(days) {
  portfolioHorizon = days;
  document.querySelectorAll('.horizon-btn').forEach(b => {
    b.classList.toggle('active', parseInt(b.dataset.days) === days);
  });
}

function buildCoinOptions(selected = '') {
  return ALL_COINS.map(sym => {
    const d = COIN_DATA[sym];
    return `<option value="${sym}" ${sym === selected ? 'selected' : ''}>${sym} â€“ ${d ? d.name : sym}</option>`;
  }).join('');
}

function addCoinRow(sym = '', usd = '') {
  const id = Date.now();
  portfolioRows.push(id);
  const list = document.getElementById('coinInputList');
  const row = document.createElement('div');
  row.className = 'coin-input-row';
  row.id = 'row-' + id;
  row.innerHTML = `
    <select onchange="updateRowCoin(${id},this.value)">${buildCoinOptions(sym)}</select>
    <input type="number" id="amt-${id}" placeholder="USD" min="0" step="0.01" value="${usd}" />
    <button class="remove-btn" onclick="removeCoinRow(${id})">âœ•</button>
  `;
  list.appendChild(row);
}

function removeCoinRow(id) {
  const el = document.getElementById('row-' + id);
  if (el) el.remove();
  portfolioRows = portfolioRows.filter(r => r !== id);
}

function updateRowCoin(id, sym) { /* Live-Preis kÃ¶nnte hier angezeigt werden */ }

function getPortfolioEntries() {
  return portfolioRows.map(id => {
    const row = document.getElementById('row-' + id);
    if (!row) return null;
    const sym = row.querySelector('select').value;
    const usd = parseFloat(document.getElementById('amt-' + id).value) || 0;
    return usd > 0 ? { sym, usd } : null;
  }).filter(Boolean);
}

async function analyzePortfolio() {
  const entries = getPortfolioEntries();
  if (entries.length === 0) {
    document.getElementById('portfolioResults').innerHTML =
      `<div class="portfolio-empty"><div class="empty-icon">âš ï¸</div><div>Bitte mindestens einen Coin mit Betrag eingeben.</div></div>`;
    return;
  }

  const btn = document.getElementById('portfolioAnalyzeBtn');
  btn.disabled = true;
  btn.textContent = 'â³ ANALYSIERE...';

  document.getElementById('portfolioResults').innerHTML =
    `<div class="portfolio-empty"><div class="empty-icon" style="animation:spin 1s linear infinite;display:inline-block">âš¡</div><div>Live-Daten werden geladen...</div></div>`;

  // â”€â”€ Live-Daten fÃ¼r alle Coins im Portfolio laden â”€â”€
  const liveData = {};
  await Promise.all(entries.map(async ({ sym }) => {
    if (liveData[sym]) return;
    const [ticker, klines] = await Promise.all([
      fetchBinanceTicker(sym),
      fetchBinanceKlines(sym, '1h', 200),
    ]);
    liveData[sym] = { ticker, klines };
    // COIN_DATA updaten
    if (ticker) {
      COIN_DATA[sym].price  = fmtPrice(ticker.price);
      COIN_DATA[sym].change = ticker.change24h.toFixed(2);
    }
    if (klines && klines.length >= 26) {
      const closes = klines.map(k => k.c);
      const rsi  = calcRSI(closes, 14);
      const macd = calcMACD(closes);
      const bb   = calcBB(closes, 20);
      const will = calcWilliams(closes, 14);
      if (rsi  !== null) { COIN_DATA[sym].rsi = rsi.toFixed(2); COIN_DATA[sym].rsiSig = rsi < 30 ? 'buy' : rsi > 70 ? 'sell' : 'neutral'; }
      if (macd !== null) { COIN_DATA[sym].macd = macd.toFixed(6); COIN_DATA[sym].macdSig = macd > 0 ? 'buy' : 'sell'; }
      if (bb   !== null)   COIN_DATA[sym].bb = bb.toFixed(4);
      if (will !== null) { COIN_DATA[sym].williams = will.toFixed(2); COIN_DATA[sym].willSig = will < -80 ? 'buy' : will > -20 ? 'sell' : 'neutral'; }
    }
  }));

  // â”€â”€ Alle anderen Coins als Tauschkandidaten auch laden â”€â”€
  const ownedSyms = new Set(entries.map(e => e.sym));
  const candidates = ALL_COINS.filter(s => !ownedSyms.has(s));
  await Promise.all(candidates.slice(0, 10).map(async sym => {
    if (liveData[sym]) return;
    const [ticker, klines] = await Promise.all([
      fetchBinanceTicker(sym),
      fetchBinanceKlines(sym, '1h', 100),
    ]);
    liveData[sym] = { ticker, klines };
    if (ticker) COIN_DATA[sym].price = fmtPrice(ticker.price);
    if (klines && klines.length >= 26) {
      const closes = klines.map(k => k.c);
      const rsi = calcRSI(closes, 14);
      const macd = calcMACD(closes);
      if (rsi  !== null) { COIN_DATA[sym].rsi = rsi.toFixed(2); COIN_DATA[sym].rsiSig = rsi < 30 ? 'buy' : rsi > 70 ? 'sell' : 'neutral'; }
      if (macd !== null) { COIN_DATA[sym].macd = macd.toFixed(6); COIN_DATA[sym].macdSig = macd > 0 ? 'buy' : 'sell'; }
    }
  }));

  document.getElementById('portfolioResults').innerHTML =
    `<div class="portfolio-empty"><div class="empty-icon" style="animation:spin 1s linear infinite;display:inline-block">âš¡</div><div>KI generiert Empfehlungen...</div></div>`;

  // â”€â”€ KI-Analyse aufrufen â”€â”€
  try {
    const result = await getPortfolioAdvice(entries, liveData, portfolioHorizon);
    renderPortfolioResults(entries, liveData, result, portfolioHorizon);
  } catch(e) {
    renderPortfolioResults(entries, liveData, null, portfolioHorizon);
  }

  btn.disabled = false;
  btn.textContent = 'âš¡ ANALYSE STARTEN';
}

// â”€â”€ Bewertungs-Score fÃ¼r einen Coin (0â€“100) â”€â”€
function scoreCoin(sym, horizon) {
  const d = COIN_DATA[sym];
  if (!d) return 0;
  let score = 50;
  const rsi  = parseFloat(d.rsi)  || 50;
  const macd = parseFloat(d.macd) || 0;
  const chg  = parseFloat(d.change) || 0;
  const p7d  = parseFloat(d.p7d)  || 0;
  const p30d = parseFloat(d.p30d) || 0;
  const bb   = parseFloat(d.bb)   || 0.15;
  const will = parseFloat(d.williams) || -50;

  // RSI (Ã¼berverkauft = Kaufgelegenheit)
  if (rsi < 25) score += 20; else if (rsi < 35) score += 12;
  else if (rsi > 75) score -= 20; else if (rsi > 65) score -= 10;

  // MACD
  if (macd > 0) score += 10; else score -= 8;

  // Williams %R
  if (will < -80) score += 8; else if (will > -20) score -= 8;

  // Trend je Horizont
  if (horizon === 3) {
    if (chg > 3) score += 8; else if (chg < -3) score -= 8;
  } else if (horizon === 7) {
    if (p7d > 5) score += 10; else if (p7d < -10) score -= 12;
    if (chg > 2) score += 5;
  } else { // 30d
    if (p30d > 10) score += 15; else if (p30d < -30) score += 8; // tief = Bounce-Chance
    if (p7d > 3) score += 8;
  }

  // VolatilitÃ¤t (bei kurzem Horizont gut fÃ¼r groÃŸe Moves)
  if (horizon <= 7 && bb > 0.2) score += 5;

  // Risiko-Abschlag
  const risk = d.risk || 3;
  score -= (risk - 2) * 3;

  return Math.max(0, Math.min(100, Math.round(score)));
}

// â”€â”€ Erwartetes Potenzial % â”€â”€
function estimatePotential(sym, horizon) {
  const d = COIN_DATA[sym];
  const score = scoreCoin(sym, horizon);
  const rsi   = parseFloat(d?.rsi) || 50;
  const bb    = parseFloat(d?.bb) || 0.15;
  const base  = score - 50;           // -50 bis +50
  const volMulti = 1 + bb * 2;        // hohes BB = mehr Potenzial
  const hMulti   = horizon === 3 ? 0.8 : horizon === 7 ? 1.4 : 3.5;
  return parseFloat((base * 0.15 * volMulti * hMulti).toFixed(1));
}

// â”€â”€ KI-Prompt fÃ¼r Portfolio â”€â”€
async function getPortfolioAdvice(entries, liveData, horizon) {
  const totalUsd = entries.reduce((s, e) => s + e.usd, 0);
  const portfolioStr = entries.map(e => {
    const d = COIN_DATA[e.sym];
    const score = scoreCoin(e.sym, horizon);
    return `  ${e.sym} (${d?.name}): $${e.usd.toFixed(2)} (${(e.usd/totalUsd*100).toFixed(1)}%) | RSI: ${d?.rsi} | MACD: ${d?.macd > 0 ? '+':''} ${d?.macd} | Signal: ${d?.signal?.toUpperCase()} | Score: ${score}/100`;
  }).join('\n');

  const topCandidates = ALL_COINS
    .filter(s => !entries.find(e => e.sym === s))
    .map(sym => ({ sym, score: scoreCoin(sym, horizon), pot: estimatePotential(sym, horizon) }))
    .sort((a, b) => b.score - a.score)
    .slice(0, 6)
    .map(c => {
      const d = COIN_DATA[c.sym];
      return `  ${c.sym} (${d?.name}): Score ${c.score}/100 | RSI: ${d?.rsi} | Potenzial: +${c.pot}% | Signal: ${d?.signal?.toUpperCase()}`;
    }).join('\n');

  const prompt = `Du bist ein erfahrener Krypto-Portfolio-Manager. Analysiere dieses Portfolio und gib prÃ¤zise Empfehlungen fÃ¼r einen Horizont von ${horizon} Tagen.

AKTUELLES PORTFOLIO (Gesamt: $${totalUsd.toFixed(2)}):
${portfolioStr}

TOP TAUSCH-KANDIDATEN (nicht im Portfolio):
${topCandidates}

Erstelle eine strukturierte Analyse auf Deutsch mit GENAU diesem Format:

PORTFOLIO-BEWERTUNG:
[2-3 SÃ¤tze zur Gesamtlage des Portfolios]

EMPFEHLUNGEN:
[FÃ¼r jeden Coin: HALTEN / TAUSCHEN GEGEN [COIN] / VERKAUFEN â€“ mit 1-2 Satz BegrÃ¼ndung und konkretem Zeitpunkt]

BESTE TAUSCH-CHANCE:
[Den einen Coin der aktuell das hÃ¶chste ${horizon}-Tage-Potenzial hat, mit BegrÃ¼ndung]

RISIKO-HINWEIS:
[1 Satz spezifisch fÃ¼r dieses Portfolio]

Maximal 280 WÃ¶rter. Keine allgemeinen Floskeln. Beziehe dich immer auf die konkreten RSI/MACD-Werte.`;

  const response = await fetch('https://api.anthropic.com/v1/messages', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      model: 'claude-sonnet-4-20250514',
      max_tokens: 1000,
      messages: [{ role: 'user', content: prompt }]
    })
  });
  const data = await response.json();
  return data.content?.[0]?.text || null;
}

// â”€â”€ Ergebnisse rendern â”€â”€
function renderPortfolioResults(entries, liveData, aiText, horizon) {
  const totalUsd = entries.reduce((s, e) => s + e.usd, 0);

  // Top-Kandidaten berechnen
  const candidates = ALL_COINS
    .filter(s => !entries.find(e => e.sym === s))
    .map(sym => ({ sym, score: scoreCoin(sym, horizon), pot: estimatePotential(sym, horizon) }))
    .sort((a, b) => b.score - a.score);

  // Empfehlung pro gehaltenem Coin
  const recommendations = entries.map(entry => {
    const { sym, usd } = entry;
    const d = COIN_DATA[sym];
    const myScore  = scoreCoin(sym, horizon);
    const myPot    = estimatePotential(sym, horizon);
    const bestAlt  = candidates[0];

    let action, targetSym, reason, colorClass;

    if (myScore >= 62) {
      action = 'hold'; targetSym = null; colorClass = 'hold';
      reason = `RSI ${d?.rsi} zeigt ${parseFloat(d?.rsi) < 40 ? 'Ã¼berverkaufte Zone â€“ Erholung wahrscheinlich' : 'gesunden AufwÃ¤rtstrend'}. MACD ${parseFloat(d?.macd) > 0 ? 'positiv' : 'dreht'} â€“ Halten fÃ¼r ${horizon} Tage empfohlen.`;
    } else if (bestAlt && bestAlt.score > myScore + 15) {
      action = 'swap'; targetSym = bestAlt.sym; colorClass = 'swap';
      const td = COIN_DATA[bestAlt.sym];
      reason = `${sym} Score ${myScore}/100 vs. ${bestAlt.sym} Score ${bestAlt.score}/100. ${bestAlt.sym} RSI ${td?.rsi} deutlich stÃ¤rker aufgestellt fÃ¼r ${horizon}-Tage-Horizont.`;
    } else if (myScore < 38) {
      action = 'sell'; targetSym = null; colorClass = 'sell';
      reason = `RSI ${d?.rsi} + MACD ${d?.macd > 0 ? 'leicht positiv' : 'negativ'} â€“ schwaches Setup. Risiko ${d?.risk}/5. Verkauf und Umdispositon erwÃ¤gen.`;
    } else {
      action = 'hold'; targetSym = null; colorClass = 'hold';
      reason = `Neutrales Signal (Score ${myScore}/100). Kein klarer Vorteil beim Tauschen â€“ Position halten und Markt beobachten.`;
    }

    return { sym, usd, d, myScore, myPot, action, targetSym, colorClass, reason };
  });

  // Gesamtpotenzial
  const avgPot = entries.reduce((s, e) => s + estimatePotential(e.sym, horizon), 0) / entries.length;
  const swapCount = recommendations.filter(r => r.action === 'swap').length;
  const holdCount = recommendations.filter(r => r.action === 'hold').length;
  const bestGlobal = candidates[0];

  const horizonLabel = horizon === 3 ? '3 Tage' : horizon === 7 ? '7 Tage' : '30 Tage';

  let html = `
  <!-- SUMMARY -->
  <div class="portfolio-summary">
    <div class="summary-stat">
      <div class="summary-stat-val" style="color:var(--accent)">$${totalUsd.toLocaleString('de-DE', {minimumFractionDigits:2,maximumFractionDigits:2})}</div>
      <div class="summary-stat-lbl">PORTFOLIO GESAMT</div>
    </div>
    <div class="summary-stat">
      <div class="summary-stat-val ${avgPot >= 0 ? 'pos' : 'neg'}" style="color:${avgPot >= 0 ? 'var(--green)' : 'var(--red)'}">${avgPot >= 0 ? '+':''}${avgPot.toFixed(1)}%</div>
      <div class="summary-stat-lbl">Ã˜ POTENZIAL (${horizonLabel})</div>
    </div>
    <div class="summary-stat">
      <div class="summary-stat-val" style="color:var(--green)">${holdCount}</div>
      <div class="summary-stat-lbl">HALTEN</div>
    </div>
    <div class="summary-stat">
      <div class="summary-stat-val" style="color:var(--yellow)">${swapCount}</div>
      <div class="summary-stat-lbl">TAUSCHEN</div>
    </div>
    ${bestGlobal ? `
    <div class="summary-stat">
      <div class="summary-stat-val" style="color:var(--accent)">${bestGlobal.sym}</div>
      <div class="summary-stat-lbl">BESTE CHANCE</div>
    </div>` : ''}
  </div>

  <!-- EMPFEHLUNGS-KARTEN -->
  <div class="advice-grid">`;

  recommendations.forEach((rec, i) => {
    const potClass = rec.myPot > 0 ? 'pos' : rec.myPot < 0 ? 'neg' : 'neu';
    const confPct  = rec.myScore;
    const confColor = confPct >= 62 ? '#00ff88' : confPct >= 45 ? '#ffd700' : '#ff3a3a';
    const actionLabel = rec.action === 'hold' ? 'â¸ HALTEN' : rec.action === 'swap' ? 'â‡„ TAUSCHEN' : 'âœ• VERKAUFEN';

    html += `
    <div class="advice-card ${rec.colorClass}" style="animation-delay:${i*0.08}s">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;">
        <div class="advice-action ${rec.colorClass}">${actionLabel}</div>
        <div style="font-family:'Share Tech Mono',monospace;font-size:11px;color:var(--text-dim)">Score: ${rec.myScore}/100</div>
      </div>
      <div class="advice-coin-row">
        <div>
          <div class="advice-coin-name">${rec.sym}</div>
          <div style="font-family:'Share Tech Mono',monospace;font-size:11px;color:var(--text-dim)">${rec.d?.name || rec.sym}</div>
        </div>
        <div style="text-align:right;">
          <div style="font-family:'Orbitron',monospace;font-size:14px;color:var(--accent)">${rec.d?.price || 'â€“'}</div>
          <div style="font-family:'Share Tech Mono',monospace;font-size:11px;color:${parseFloat(rec.d?.change) >= 0 ? 'var(--green)':'var(--red)'}">
            ${parseFloat(rec.d?.change) >= 0 ? 'â–² +':' â–¼ '}${rec.d?.change}%
          </div>
        </div>
      </div>
      ${rec.action === 'swap' && rec.targetSym ? `
      <div style="display:flex;align-items:center;gap:8px;margin:8px 0;">
        <span style="font-family:'Orbitron',monospace;font-size:13px;color:var(--text-dim)">${rec.sym}</span>
        <span style="color:var(--green);font-size:18px">â†’</span>
        <span style="font-family:'Orbitron',monospace;font-size:15px;color:var(--green);font-weight:900">${rec.targetSym}</span>
        <span style="font-family:'Share Tech Mono',monospace;font-size:10px;color:var(--text-dim)">(${COIN_DATA[rec.targetSym]?.name})</span>
      </div>
      <div style="font-family:'Orbitron',monospace;font-size:13px;color:var(--green);margin-bottom:4px;">
        Potenzial: +${estimatePotential(rec.targetSym, horizon)}% (${horizonLabel})
      </div>` : ''}
      <div class="advice-potential ${potClass}">
        ${rec.myPot >= 0 ? '+':''}${rec.myPot}%
        <span style="font-family:'Share Tech Mono',monospace;font-size:11px;color:var(--text-dim);font-weight:400"> (${horizonLabel})</span>
      </div>
      <div class="advice-meta">
        <div class="advice-meta-item">RSI: <strong>${rec.d?.rsi || 'â€“'}</strong></div>
        <div class="advice-meta-item">MACD: <strong style="color:${parseFloat(rec.d?.macd)>0?'var(--green)':'var(--red)'}">
          ${parseFloat(rec.d?.macd) > 0 ? 'â–²' : 'â–¼'} ${rec.d?.macd || 'â€“'}</strong></div>
        <div class="advice-meta-item">Risiko: <strong>${rec.d?.risk || 'â€“'}/5</strong></div>
        <div class="advice-meta-item">Wert: <strong>$${rec.usd.toLocaleString('de-DE',{minimumFractionDigits:2,maximumFractionDigits:2})}</strong></div>
      </div>
      <div class="advice-reason">${rec.reason}</div>
      <div class="confidence-bar-wrap">
        <label>SIGNAL-STÃ„RKE: ${confPct}%</label>
        <div class="confidence-bar">
          <div class="confidence-fill" style="width:0%;background:${confColor};transition:width 1.2s ease ${i*0.1}s;"
            data-target="${confPct}"></div>
        </div>
      </div>
    </div>`;
  });

  html += `</div>`;

  // KI-Analyse
  if (aiText) {
    html += `
    <div class="ai-full-advice">
      <h3>âš¡ KI PORTFOLIO-ANALYSE Â· ${horizonLabel.toUpperCase()}</h3>
      <pre>${aiText}</pre>

```
</div>`;
```

}

document.getElementById(â€˜portfolioResultsâ€™).innerHTML = html;

// Confidence-Bars animieren
setTimeout(() => {
document.querySelectorAll(â€™.confidence-fill[data-target]â€™).forEach(el => {
el.style.width = el.dataset.target + â€˜%â€™;
});
}, 100);
}

// Portfolio-Seite initialisieren
function initPortfolio() {
if (portfolioRows.length === 0) {
addCoinRow(â€˜XRPâ€™, â€˜â€™);
addCoinRow(â€˜SOLâ€™, â€˜â€™);
}
}

// CSS spin animation
const spinStyle = document.createElement(â€˜styleâ€™);
spinStyle.textContent = â€˜@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}â€™;
document.head.appendChild(spinStyle);

// Globaler Fehler-AuffÃ¤nger
window.onerror = function(msg, src, line, col, err) {
console.error(â€˜Global JS Error:â€™, msg, â€˜Zeile:â€™, line, err);
// Overlay immer schlieÃŸen falls offen
var ov = document.getElementById(â€˜loadingOverlayâ€™);
var btn = document.getElementById(â€˜analyzeBtnâ€™);
if (ov) ov.classList.remove(â€˜activeâ€™);
if (btn) btn.disabled = false;
return false;
};

// Enter key support
document.addEventListener(â€˜DOMContentLoadedâ€™, function() {
try {
[â€˜loginUserâ€™,â€˜loginPassâ€™].forEach(function(id) {
var el = document.getElementById(id);
if (el) el.addEventListener(â€˜keydownâ€™, function(e) {
if (e.key === â€˜Enterâ€™) doLogin();
});
});
} catch(e) { console.warn(â€˜DOMContentLoaded:â€™, e); }
});

// Clock
function updateTime() {
const now = new Date();
const d = now.toLocaleDateString(â€˜de-DEâ€™, { day:â€˜2-digitâ€™, month:â€˜longâ€™, year:â€˜numericâ€™ });
const t = now.toLocaleTimeString(â€˜de-DEâ€™, { hour:â€˜2-digitâ€™, minute:â€˜2-digitâ€™ });
const el = document.getElementById(â€˜timestampâ€™);
if (el) el.textContent = `${d.toUpperCase()} Â· ${t} CET`;
}
updateTime();
setInterval(updateTime, 60000);
</script>

</body>
</html>